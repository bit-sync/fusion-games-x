!function(e){function t(t){for(var n,o,i=t[0],s=t[1],a=0,l=[];a<i.length;a++)o=i[a],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&l.push(r[o][0]),r[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(c&&c(t);l.length;)l.shift()()}var n={},r={1:0};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,o){n=r[e]=[t,o]}));t.push(n[2]=i);var s,a=document.createElement("script");a.charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.src=function(e){return o.p+"../"+({0:"./js/fenpos"}[e]||e)+"_00f9fc0b46eacf111aef_bundle.js"}(e);var c=new Error;s=function(t){a.onerror=a.onload=null,clearTimeout(l);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+o+": "+i+")",c.name="ChunkLoadError",c.type=o,c.request=i,n[1](c)}r[e]=void 0}};var l=setTimeout((function(){s({type:"timeout",target:a})}),12e4);a.onerror=a.onload=s,document.head.appendChild(a)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var a=0;a<i.length;a++)t(i[a]);var c=s;o(o.s=133)}([function(e,t,n){var r=n(73),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();e.exports=i},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,n){var r=n(30),o=n(49);e.exports=function(e){return null!=e&&o(e.length)&&!r(e)}},function(e,t,n){var r=n(74),o=n(75),i=n(4);e.exports=function(e){return i(e)?r(e):o(e)}},function(e,t,n){"use strict";t.__esModule=!0,t.extend=a,t.indexOf=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!i.test(e))return e;return e.replace(o,s)},t.isEmpty=function(e){return!e&&0!==e||!(!u(e)||0!==e.length)},t.createFrame=function(e){var t=a({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},o=/[&<>"'`=]/g,i=/[&<>"'`=]/;function s(e){return r[e]}function a(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}var c=Object.prototype.toString;t.toString=c;var l=function(e){return"function"==typeof e};l(/x/)&&(t.isFunction=l=function(e){return"function"==typeof e&&"[object Function]"===c.call(e)}),t.isFunction=l;var u=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===c.call(e)};t.isArray=u},function(e,t,n){var r=n(11),o=n(138),i=n(139),s="[object Null]",a="[object Undefined]",c=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:s:c&&c in Object(e)?o(e):i(e)}},function(e,t,n){var r=n(1),o=n(61),i=n(213),s=n(54);e.exports=function(e,t){return r(e)?e:o(e,t)?[e]:i(s(e))}},function(e,t,n){var r=n(25),o=1/0;e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}},function(e,t,n){var r=n(46),o=n(161),i=n(15),s={extend:function(){var e=o(arguments);return e.unshift(this),i.apply(null,e)},reset:function(){for(var e in this.off(),this)"extend"!==e&&"reset"!==e&&delete this[e];r.createEmitter(this)}};r.createEmitter(s),e.exports=s},function(e,t,n){var r=n(0).Symbol;e.exports=r},function(e,t,n){var r=n(147),o=n(150);e.exports=function(e,t){var n=o(e,t);return r(n)?n:void 0}},function(e,t,n){"use strict";t.__esModule=!0;var r=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function o(e,t){var n=t&&t.loc,i=void 0,s=void 0,a=void 0,c=void 0;n&&(i=n.start.line,s=n.end.line,a=n.start.column,c=n.end.column,e+=" - "+i+":"+a);for(var l=Error.prototype.constructor.call(this,e),u=0;u<r.length;u++)this[r[u]]=l[r[u]];Error.captureStackTrace&&Error.captureStackTrace(this,o);try{n&&(this.lineNumber=i,this.endLineNumber=s,Object.defineProperty?(Object.defineProperty(this,"column",{value:a,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:c,enumerable:!0})):(this.column=a,this.endColumn=c))}catch(e){}}o.prototype=new Error,t.default=o,e.exports=t.default},function(e,t,n){var r=n(146),o=n(50),i=n(151),s=n(78),a=n(79),c=n(7),l=n(77),u=l(r),f=l(o),d=l(i),p=l(s),h=l(a),v=c;(r&&"[object DataView]"!=v(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=v(new o)||i&&"[object Promise]"!=v(i.resolve())||s&&"[object Set]"!=v(new s)||a&&"[object WeakMap]"!=v(new a))&&(v=function(e){var t=c(e),n="[object Object]"==t?e.constructor:void 0,r=n?l(n):"";if(r)switch(r){case u:return"[object DataView]";case f:return"[object Map]";case d:return"[object Promise]";case p:return"[object Set]";case h:return"[object WeakMap]"}return t}),e.exports=v},function(e,t,n){var r=n(31),o=n(16),i=n(152),s=n(4),a=n(20),c=n(5),l=Object.prototype.hasOwnProperty,u=i((function(e,t){if(a(t)||s(t))o(t,c(t),e);else for(var n in t)l.call(t,n)&&r(e,n,t[n])}));e.exports=u},function(e,t,n){var r=n(31),o=n(80);e.exports=function(e,t,n,i){var s=!n;n||(n={});for(var a=-1,c=t.length;++a<c;){var l=t[a],u=i?i(n[l],e[l],l,n,e):void 0;void 0===u&&(u=e[l]),s?o(n,l,u):r(n,l,u)}return n}},function(e,t,n){var r=n(21),o=n(82),i=n(51);e.exports=function(e,t){return i(o(e,t,r),e+"")}},function(e,t){var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var o=typeof e;return!!(t=null==t?n:t)&&("number"==o||"symbol"!=o&&r.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t){e.exports=function(e){return e}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t){var n="__lodash_placeholder__";e.exports=function(e,t){for(var r=-1,o=e.length,i=0,s=[];++r<o;){var a=e[r];a!==t&&a!==n||(e[r]=n,s[i++]=r)}return s}},function(e,t,n){var r=n(136);e.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}},function(e,t,n){var r=n(7),o=n(2),i="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||o(e)&&r(e)==i}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(141),o=n(2),i=Object.prototype,s=i.hasOwnProperty,a=i.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(e){return o(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},function(e,t,n){(function(e){var r=n(0),o=n(142),i=t&&!t.nodeType&&t,s=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=s&&s.exports===i?r.Buffer:void 0,c=(a?a.isBuffer:void 0)||o;e.exports=c}).call(this,n(47)(e))},function(e,t,n){(function(e){var r=n(73),o=t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=i&&i.exports===o&&r.process,a=function(){try{var e=i&&i.require&&i.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=a}).call(this,n(47)(e))},function(e,t,n){var r=n(7),o=n(3),i="[object AsyncFunction]",s="[object Function]",a="[object GeneratorFunction]",c="[object Proxy]";e.exports=function(e){if(!o(e))return!1;var t=r(e);return t==s||t==a||t==i||t==c}},function(e,t,n){var r=n(80),o=n(32),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var s=e[t];i.call(e,t)&&o(s,n)&&(void 0!==n||t in e)||r(e,t,n)}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}},function(e,t){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},function(e,t,n){var r=n(7),o=n(1),i=n(2),s="[object String]";e.exports=function(e){return"string"==typeof e||!o(e)&&i(e)&&r(e)==s}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var r=n(171),o=n(172),i=n(173),s=n(174),a=n(175);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,n){var r=n(32);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(12)(Object,"create");e.exports=r},function(e,t,n){var r=n(189);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t,n){var r=n(3),o=Object.create,i=function(){function e(){}return function(t){if(!r(t))return{};if(o)return o(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=i},function(e,t,n){var r=n(8),o=n(9);e.exports=function(e,t){for(var n=0,i=(t=r(t,e)).length;null!=e&&n<i;)e=e[o(t[n++])];return n&&n==i?e:void 0}},function(e,t,n){var r=n(41),o=n(3);e.exports=function(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=r(e.prototype),i=e.apply(n,t);return o(i)?i:n}}},function(e,t){e.exports=function(e){return e.placeholder}},function(e,t,n){e.exports=n(286).default},function(e,t,n){var r=n(134),o=n(5),i=n(145),s=n(15),a=n(84),c=Array.prototype.slice,l=n(159),u={on:function(e,t,n){return l.eventsApi(this,"on",e,[t,n])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:n,ctx:n||this}),this):this},once:function(e,t,n){if(!l.eventsApi(this,"once",e,[t,n])||!t)return this;var o=this,i=r((function(){o.off(e,i),t.apply(this,arguments)}));return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,a,c,u,f,d;if(!this._events||!l.eventsApi(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(c=0,u=(a=e?[e]:o(this._events)).length;c<u;c++)if(e=a[c],s=this._events[e]){if(this._events[e]=r=[],t||n)for(f=0,d=s.length;f<d;f++)i=s[f],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=c.call(arguments,1);if(!l.eventsApi(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l.triggerEvents(n,t),r&&l.triggerEvents(r,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var o=!t&&!n;n||"object"!=typeof t||(n=this),e&&((r={})[e._listenId]=e);var s=this;return a(r,(function(e,r){e.off(t,n,s),(o||i(e._events))&&delete s._listeningTo[r]})),this},createEmitter:function(e){return s(e||{},u)},listenTo:l.createListenMethod("on"),listenToOnce:l.createListenMethod("once"),listenToAndRun:function(e,t,n){return this.listenTo.apply(this,arguments),n||"object"!=typeof t||(n=this),n.apply(this),this}};u.bind=u.on,u.unbind=u.off,u.removeListener=u.off,u.removeAllListeners=u.off,u.emit=u.trigger,e.exports=u},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(143),o=n(19),i=n(29),s=i&&i.isTypedArray,a=s?o(s):r;e.exports=a},function(e,t){var n=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}},function(e,t,n){var r=n(12)(n(0),"Map");e.exports=r},function(e,t,n){var r=n(153),o=n(83)(r);e.exports=o},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},function(e,t,n){var r=n(54),o=0;e.exports=function(e){var t=++o;return r(e)+t}},function(e,t,n){var r=n(160);e.exports=function(e){return null==e?"":r(e)}},function(e,t,n){var r=n(37),o=n(176),i=n(177),s=n(178),a=n(179),c=n(180);function l(e){var t=this.__data__=new r(e);this.size=t.size}l.prototype.clear=o,l.prototype.delete=i,l.prototype.get=s,l.prototype.has=a,l.prototype.set=c,e.exports=l},function(e,t,n){var r=n(181),o=n(188),i=n(190),s=n(191),a=n(192);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,n){var r=n(199),o=n(92),i=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols,a=s?function(e){return null==e?[]:(e=Object(e),r(s(e),(function(t){return i.call(e,t)})))}:o;e.exports=a},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}},function(e,t,n){var r=n(76)(Object.getPrototypeOf,Object);e.exports=r},function(e,t,n){var r=n(97);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},function(e,t,n){var r=n(1),o=n(25),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(r(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!o(e))||(s.test(e)||!i.test(e)||null!=t&&e in Object(t))}},function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},function(e,t,n){var r=n(58),o=n(219);e.exports=function e(t,n,i,s,a){var c=-1,l=t.length;for(i||(i=o),a||(a=[]);++c<l;){var u=t[c];n>0&&i(u)?n>1?e(u,n-1,i,s,a):r(a,u):s||(a[a.length]=u)}return a}},function(e,t,n){var r=n(230),o=n(2);e.exports=function e(t,n,i,s,a){return t===n||(null==t||null==n||!o(t)&&!o(n)?t!=t&&n!=n:r(t,n,i,s,e,a))}},function(e,t,n){var r=n(56),o=n(231),i=n(232);function s(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}s.prototype.add=s.prototype.push=o,s.prototype.has=i,e.exports=s},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(101);e.exports=function(e,t){return!!(null==e?0:e.length)&&r(e,t,0)>-1}},function(e,t,n){var r=n(90),o=n(243),i=n(276),s=n(53),a=(n(111),n(15)),c=(n(84),n(105)),l=n(62),u=n(35),f=(n(117),n(100)),d=n(110),p=n(277),h=n(130),v=n(281),m=n(116);function g(e){this.cid=s("view"),e||(e={});var t=e.parent;delete e.parent,_.call(this,e,{init:!1,parent:t}),this.on("change:el",this._handleElementChange,this),this._upsertBindings(),this.template=e.template||this.template,this._cache.rendered=!1,this.initialize.apply(this,arguments),this.autoRender&&this.template&&this.render()}var _=r.extend({dataTypes:{element:{set:function(e){return{val:e,type:e instanceof Element?"element":typeof e}},compare:function(e,t){return e===t}},collection:{set:function(e){return{val:e,type:e&&e.isCollection?"collection":typeof e}},compare:function(e,t){return e===t}}},props:{model:"state",el:"element",collection:"collection"},session:{_rendered:["boolean",!0,!1]},derived:{hasData:{deps:["model"],fn:function(){return!!this.model}},rendered:{deps:["_rendered"],fn:function(){return this._rendered?(this.trigger("render",this),!0):(this.trigger("remove",this),!1)}}}});g.prototype=Object.create(_.prototype);var b="Query cannot be performed as this.el is not defined. Ensure that the view has been rendered.";a(g.prototype,{query:function(e){if(!this.el)throw new Error(b);return e?"string"==typeof e?h(this.el,e)?this.el:this.el.querySelector(e)||void 0:e:this.el},queryAll:function(e){if(!this.el)throw new Error(b);if(!e)return[this.el];var t=[];return h(this.el,e)&&t.push(this.el),t.concat(Array.prototype.slice.call(this.el.querySelectorAll(e)))},queryByHook:function(e){return this.query('[data-hook~="'+e+'"]')},queryAllByHook:function(e){return this.queryAll('[data-hook~="'+e+'"]')},initialize:function(){},_render:function(){return this._upsertBindings(),this.renderWithTemplate(this),this._rendered=!0,this},_remove:function(){return this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),this._rendered=!1,this._downsertBindings(),this},_handleElementChange:function(e,t){return this.eventManager&&this.eventManager.unbind(),this.eventManager=p(this.el,this),this.delegateEvents(),this._applyBindingsForKey(),this},delegateEvents:function(e){if(!e&&!(e=c(this,"events")))return this;for(var t in this.undelegateEvents(),e)this.eventManager.bind(t,e[t]);return this},undelegateEvents:function(){return this.eventManager.unbind(),this},registerSubview:function(e){return this._subviews=this._subviews||[],this._subviews.push(e),e.parent||(e.parent=this),e},renderSubview:function(e,t){return"string"==typeof t&&(t=this.query(t)),t||(t=this.el),this.registerSubview(e),e.render(),t.appendChild(e.el),e},_applyBindingsForKey:function(e){if(this.el){var t,n=this._parsedBindings.getGrouped(e);for(t in n)n[t].forEach((function(e){e(this.el,m(this,t),l(t.split(".")))}),this)}},_initializeBindings:function(){this.bindings&&this.on("all",(function(e){"change:"===e.slice(0,7)&&this._applyBindingsForKey(e.split(":")[1])}),this)},_initializeSubviews:function(){if(this.subviews)for(var e in this.subviews)this._parseSubview(this.subviews[e],e)},_parseSubview:function(e,t){e.container&&(e.selector=e.container);var n=this._parseSubviewOpts(e);this.on("change",(function e(){var r,o;this.el&&(r=this.query(n.selector))&&(n.waitFor&&!m(this,n.waitFor)||((o=this[t]=n.prepareView.call(this,r)).el?(o.render(),this.registerSubview(o)):this.renderSubview(o,r),this.off("change",e)))}),this)},_parseSubviewOpts:function(e){var t=this;return{selector:e.selector||'[data-hook="'+e.hook+'"]',waitFor:e.waitFor||"",prepareView:e.prepareView||function(){return new e.constructor({parent:t})}}},renderWithTemplate:function(e,t){var n=t||this.template;if(!n)throw new Error("Template string or function needed.");var r=u(n)?n:n.call(this,e||this);u(r)&&(r=i(r));var o=this.el&&this.el.parentNode;if(o&&o.replaceChild(r,this.el),"#document-fragment"===r.nodeName)throw new Error("Views can only have one root element, including comment nodes.");return this.el=r,this},cacheElements:function(e){for(var t in e)this[t]=this.query(e[t]);return this},animateRemove:function(){this.remove()},renderCollection:function(e,t,n,r){var i="string"==typeof n?this.query(n):n,s=a({collection:e,el:i||this.el,view:t,parent:this,viewOptions:{parent:this}},r),c=new o(s);return c.render(),this.registerSubview(c)},_setRender:function(e){Object.defineProperty(e,"render",{get:function(){return this._render},set:function(e){this._render=function(){return e.apply(this,arguments),this._rendered=!0,this}}})},_setRemove:function(e){Object.defineProperty(e,"remove",{get:function(){return this._remove},set:function(e){this._remove=function(){return e.apply(this,arguments),this._rendered=!1,this}}})},_downsertBindings:function(){this._parsedBindings;this.bindingsSet&&(this._subviews&&(d(f(this._subviews),"remove"),this._subviews=[]),this.stopListening(),this.bindingsSet=!1)},_upsertBindings:function(e){e=e||this,this.bindingsSet||(this._parsedBindings=v(this.bindings,this),this._initializeBindings(),e.el&&!this.autoRender&&this._handleElementChange(),this._initializeSubviews(),this.bindingsSet=!0)}}),g.prototype._setRender(g.prototype),g.prototype._setRemove(g.prototype),g.extend=_.extend,e.exports=g},function(e,t,n){var r=n(41),o=n(70),i=4294967295;function s(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=i,this.__views__=[]}s.prototype=r(o.prototype),s.prototype.constructor=s,e.exports=s},function(e,t){e.exports=function(){}},function(e,t,n){(function(t){var n="Expected a function",r=NaN,o="[object Symbol]",i=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,u="object"==typeof t&&t&&t.Object===Object&&t,f="object"==typeof self&&self&&self.Object===Object&&self,d=u||f||Function("return this")(),p=Object.prototype.toString,h=Math.max,v=Math.min,m=function(){return d.Date.now()};function g(e,t,r){var o,i,s,a,c,l,u=0,f=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError(n);function g(t){var n=o,r=i;return o=i=void 0,u=t,a=e.apply(r,n)}function y(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-u>=s}function w(){var e=m();if(y(e))return x(e);c=setTimeout(w,function(e){var n=t-(e-l);return d?v(n,s-(e-u)):n}(e))}function x(e){return c=void 0,p&&o?g(e):(o=i=void 0,a)}function k(){var e=m(),n=y(e);if(o=arguments,i=this,l=e,n){if(void 0===c)return function(e){return u=e,c=setTimeout(w,t),f?g(e):a}(l);if(d)return c=setTimeout(w,t),g(l)}return void 0===c&&(c=setTimeout(w,t)),a}return t=b(t)||0,_(r)&&(f=!!r.leading,s=(d="maxWait"in r)?h(b(r.maxWait)||0,t):s,p="trailing"in r?!!r.trailing:p),k.cancel=function(){void 0!==c&&clearTimeout(c),u=0,o=l=i=c=void 0},k.flush=function(){return void 0===c?a:x(m())},k}function _(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==o}(e))return r;if(_(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var n=a.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):s.test(e)?r:+e}e.exports=function(e,t,r){var o=!0,i=!0;if("function"!=typeof e)throw new TypeError(n);return _(r)&&(o="leading"in r?!!r.leading:o,i="trailing"in r?!!r.trailing:i),g(e,t,{leading:o,maxWait:t,trailing:i})}}).call(this,n(26))},function(e,t){var n;function r(e,t){return t.total-e.total}e.exports={saveRankings:function(e){n=(n=e.sort(r)).map((function(e,t){return e.index=t,e}))},getRanking:function(e){if(n&&n.length){var t=n.filter((function(t){return t.eco===e}));return t&&t[0].index+1}}}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(26))},function(e,t,n){var r=n(140),o=n(27),i=n(1),s=n(28),a=n(18),c=n(48),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=i(e),u=!n&&o(e),f=!n&&!u&&s(e),d=!n&&!u&&!f&&c(e),p=n||u||f||d,h=p?r(e.length,String):[],v=h.length;for(var m in e)!t&&!l.call(e,m)||p&&("length"==m||f&&("offset"==m||"parent"==m)||d&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,v))||h.push(m);return h}},function(e,t,n){var r=n(20),o=n(144),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=[];for(var n in Object(e))i.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(12)(n(0),"Set");e.exports=r},function(e,t,n){var r=n(12)(n(0),"WeakMap");e.exports=r},function(e,t,n){var r=n(81);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){var r=n(12),o=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},function(e,t,n){var r=n(22),o=Math.max;e.exports=function(e,t,n){return t=o(void 0===t?e.length-1:t,0),function(){for(var i=arguments,s=-1,a=o(i.length-t,0),c=Array(a);++s<a;)c[s]=i[t+s];s=-1;for(var l=Array(t+1);++s<t;)l[s]=i[s];return l[t]=n(c),r(e,this,l)}}},function(e,t){var n=800,r=16,o=Date.now;e.exports=function(e){var t=0,i=0;return function(){var s=o(),a=r-(s-i);if(i=s,a>0){if(++t>=n)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){var r=n(52),o=n(85),i=n(87),s=n(1);e.exports=function(e,t){return(s(e)?r:o)(e,i(t))}},function(e,t,n){var r=n(86),o=n(158)(r);e.exports=o},function(e,t,n){var r=n(156),o=n(5);e.exports=function(e,t){return e&&r(e,t,o)}},function(e,t,n){var r=n(21);e.exports=function(e){return"function"==typeof e?e:r}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},function(e,t,n){var r=n(167),o=n(5);e.exports=function(e){return null==e?[]:r(e,o(e))}},function(e,t,n){"use strict";var r=n(53),o=n(15),i=function(e){return o({},e)},s=n(169),a=n(220),c=n(223),l=n(224),u=n(35),f=n(3),d=n(227),p=n(30),h=n(229),v=n(236),m=n(105),g=n(238),_=n(46),b=n(109),y=n(241),w=/^change:/,x=function(){};function k(e,t){t||(t={}),this.cid||(this.cid=r("state")),this._events={},this._values={},this._eventBubblingHandlerCache={},this._definition=Object.create(this._definition),t.parse&&(e=this.parse(e,t)),this.parent=t.parent,this.collection=t.collection,this._keyTree=new b,this._initCollections(),this._initChildren(),this._cache={},this._previousAttributes={},e&&this.set(e,o({silent:!0,initial:!0},t)),this._changed={},this._derived&&this._initDerived(),!1!==t.init&&this.initialize.apply(this,arguments)}function E(e,t,n,r){var o,i,s=e._definition[t]={};if(u(n))(o=e._ensureValidType(n))&&(s.type=o);else{if(Array.isArray(n)&&(n={type:(i=n)[0],required:i[1],default:i[2]}),(o=e._ensureValidType(n.type))&&(s.type=o),n.required&&(s.required=!0),n.default&&"object"==typeof n.default)throw new TypeError("The default value for "+t+" cannot be an object/array, must be a value or a function which returns a value/object/array");s.default=n.default,s.allowNull=!!n.allowNull&&n.allowNull,n.setOnce&&(s.setOnce=!0),s.required&&void 0===s.default&&!s.setOnce&&(s.default=e._getDefaultForType(o)),s.test=n.test,s.values=n.values}return r&&(s.session=!0),o||(o=u(n)?n:n.type,console.warn("Invalid data type of `"+o+"` for `"+t+"` property. Use one of the default types or define your own")),Object.defineProperty(e,t,{set:function(e){this.set(t,e)},get:function(){if(!this._values)throw Error('You may be trying to `extend` a state object with "'+t+'" which has been defined in `props` on the object being extended');var e=this._values[t],n=this._dataTypes[s.type];if(void 0!==e)return n&&n.get&&(e=n.get(e)),e;var r=m(s,"default");(this._values[t]=r,void 0!==r)&&this._getOnChangeForType(s.type)(r,e,t);return r}}),s}function C(e,t,n){(e._derived[t]={fn:p(n)?n:n.fn,cache:!1!==n.cache,depList:n.deps||[]}).depList.forEach((function(n){e._deps[n]=g(e._deps[n]||[],[t])})),Object.defineProperty(e,t,{get:function(){return this._getDerivedProperty(t)},set:function(){throw new TypeError("`"+t+"` is a derived property, it can't be set directly.")}})}o(k.prototype,_,{extraProperties:"ignore",idAttribute:"id",namespaceAttribute:"namespace",typeAttribute:"modelType",initialize:function(){return this},getId:function(){return this[this.idAttribute]},getNamespace:function(){return this[this.namespaceAttribute]},getType:function(){return this[this.typeAttribute]},isNew:function(){return null==this.getId()},escape:function(e){return a(this.get(e))},isValid:function(e){return this._validate({},o(e||{},{validate:!0}))},parse:function(e,t){return e},serialize:function(e){var t=o({props:!0},e),n=this.getAttributes(t,!0),r=function(e,t){n[t]=this[t].serialize()}.bind(this);return c(this._children,r),c(this._collections,r),n},set:function(e,t,n){var r,o,i,s,a,c,u,d,p,h,v,g,_,b,y,w,x,k=this,E=this.extraProperties;if(f(e)||null===e?(p=e,n=t):(p={})[e]=t,n=n||{},!this._validate(p,n))return!1;g=n.unset,v=n.silent,b=n.initial,r=this._changing,this._changing=!0,o=[],b?this._previousAttributes={}:r||(this._previousAttributes=this.attributes,this._changed={});for(var C=0,S=Object.keys(p),M=S.length;C<M;C++){if(i=typeof(s=p[d=S[C]]),_=this._values[d],!(a=this._definition[d])){if(this._children[d]||this._collections[d]){f(s)||(s={}),this[d].set(s,n);continue}if("ignore"===E)continue;if("reject"===E)throw new TypeError('No "'+d+'" property defined on '+(this.type||"this")+' model and extraProperties not set to "ignore" or "allow"');if("allow"===E)a=this._createPropertyDefinition(d,"any");else if(E)throw new TypeError('Invalid value for extraProperties: "'+E+'"')}if(w=this._getCompareForType(a.type),x=this._getOnChangeForType(a.type),(h=this._dataTypes[a.type])&&h.set&&(s=(c=h.set(s)).val,i=c.type),a.test&&(u=a.test.call(this,s,i)))throw new TypeError("Property '"+d+"' failed validation with error: "+u);if(void 0===s&&a.required)throw new TypeError("Required property '"+d+"' must be of type "+a.type+". Tried to set "+s);if(null===s&&a.required&&!a.allowNull)throw new TypeError("Property '"+d+"' must be of type "+a.type+" (cannot be null). Tried to set "+s);if(a.type&&"any"!==a.type&&a.type!==i&&null!=s)throw new TypeError("Property '"+d+"' must be of type "+a.type+". Tried to set "+s);if(a.values&&!l(a.values,s)){var A=m(a,"default");if(g&&void 0!==A)s=A;else if(!g||g&&void 0!==s)throw new TypeError("Property '"+d+"' must be one of values: "+a.values.join(", ")+". Tried to set "+s)}if(y=b||!w(_,s,d),a.setOnce&&void 0!==_&&y)throw new TypeError("Property '"+d+"' can only be set once.");y?(x(s,_,d),b||(this._changed[d]=s,this._previousAttributes[d]=_,g&&delete this._values[d],v||o.push({prev:_,val:s,key:d})),g||(this._values[d]=s)):delete this._changed[d]}if(o.length&&(this._pending=!0),o.forEach((function(e){k.trigger("change:"+e.key,k,e.val,n)})),r)return this;for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},get:function(e){return this[e]},toggle:function(e){var t=this._definition[e];if("boolean"===t.type)this[e]=!this[e];else{if(!t||!t.values)throw new TypeError("Can only toggle properties that are type `boolean` or have `values` array.");this[e]=y(t.values,this[e])}return this},previousAttributes:function(){return i(this._previousAttributes)},hasChanged:function(e){return null==e?!!Object.keys(this._changed).length:v(this._derived,e)?this._derived[e].depList.some((function(e){return this.hasChanged(e)}),this):v(this._changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i(this._changed);var t,n,r=!1,o=this._changing?this._previousAttributes:this.attributes;for(var s in e)(n=this._definition[s])&&(this._getCompareForType(n.type)(o[s],t=e[s])||((r||(r={}))[s]=t));return r},toJSON:function(){return this.serialize()},unset:function(e,t){var n=this;(e=Array.isArray(e)?e:[e]).forEach((function(e){var r,i=n._definition[e];if(i)return i.required?(r=m(i,"default"),n.set(e,r,t)):n.set(e,r,o({},t,{unset:!0}))}))},clear:function(e){var t=this;return Object.keys(this.attributes).forEach((function(n){t.unset(n,e)})),this},previous:function(e){return null!=e&&Object.keys(this._previousAttributes).length?this._previousAttributes[e]:null},_getDefaultForType:function(e){var t=this._dataTypes[e];return t&&t.default},_getCompareForType:function(e){var t=this._dataTypes[e];return t&&t.compare?t.compare.bind(this):h},_getOnChangeForType:function(e){var t=this._dataTypes[e];return t&&t.onChange?t.onChange.bind(this):x},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=o({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,o(t||{},{validationError:n})),!1)},_createPropertyDefinition:function(e,t,n){return E(this,e,t,n)},_ensureValidType:function(e){return l(["string","number","boolean","array","object","date","state","any"].concat(Object.keys(this._dataTypes)),e)?e:void 0},getAttributes:function(e,t){e=o({session:!1,props:!1,derived:!1},e||{});var n,r,i={};for(var s in this._definition)r=this._definition[s],(e.session&&r.session||e.props&&!r.session)&&(n=t?this._values[s]:this[s],t&&n&&p(n.serialize)&&(n=n.serialize()),void 0===n&&(n=m(r,"default")),void 0!==n&&(i[s]=n));if(e.derived)for(var a in this._derived)i[a]=this[a];return i},_initDerived:function(){var e=this;c(this._derived,(function(t,n){var r=e._derived[n];r.deps=r.depList;var o=function(){var t=r.fn.call(e);e._cache[n]===t&&r.cache||(r.cache&&(e._previousAttributes[n]=e._cache[n]),e._cache[n]=t,e.trigger("change:"+n,e,e._cache[n]))};r.deps.forEach((function(t){e._keyTree.add(t,o)}))})),this.on("all",(function(t){w.test(t)&&e._keyTree.get(t.split(":")[1]).forEach((function(e){e()}))}),this)},_getDerivedProperty:function(e,t){return this._derived[e].cache?(!t&&this._cache.hasOwnProperty(e)||(this._cache[e]=this._derived[e].fn.apply(this)),this._cache[e]):this._derived[e].fn.apply(this)},_initCollections:function(){var e;if(this._collections)for(e in this._collections)this._safeSet(e,new this._collections[e](null,{parent:this}))},_initChildren:function(){var e;if(this._children)for(e in this._children)this._safeSet(e,new this._children[e]({},{parent:this})),this.listenTo(this[e],"all",this._getCachedEventBubblingHandler(e))},_getCachedEventBubblingHandler:function(e){return this._eventBubblingHandlerCache[e]||(this._eventBubblingHandlerCache[e]=function(t,n,r){w.test(t)?this.trigger("change:"+e+"."+t.split(":")[1],n,r):"change"===t&&this.trigger("change",this)}.bind(this)),this._eventBubblingHandlerCache[e]},_verifyRequired:function(){var e=this.attributes;for(var t in this._definition)if(this._definition[t].required&&void 0===e[t])return!1;return!0},_safeSet:function(e,t){if(e in this)throw new Error("Encountered namespace collision while setting instance property `"+e+"`");return this[e]=t,this}}),Object.defineProperties(k.prototype,{attributes:{get:function(){return this.getAttributes({props:!0,session:!0})}},all:{get:function(){return this.getAttributes({session:!0,props:!0,derived:!0})}},isState:{get:function(){return!0},set:function(){}}});var S={string:{default:function(){return""}},date:{set:function(e){var t;if(null==e)t="object";else if(d(e))t="date",e=e.valueOf();else{var n=null,r=new Date(e).valueOf();isNaN(r)&&(r=new Date(parseInt(e,10)).valueOf(),isNaN(r)&&(n=!0)),e=r,t="date",n&&(t=typeof e)}return{val:e,type:t}},get:function(e){return null==e?e:new Date(e)},default:function(){return new Date}},array:{set:function(e){return{val:e,type:Array.isArray(e)?"array":typeof e}},default:function(){return[]}},object:{set:function(e){var t=typeof e;return"object"!==t&&void 0===e&&(e=null,t="object"),{val:e,type:t}},default:function(){return{}}},state:{set:function(e){return e instanceof k||e&&e.isState?{val:e,type:"state"}:{val:e,type:typeof e}},compare:function(e,t){return e===t},onChange:function(e,t,n){t&&this.stopListening(t,"all",this._getCachedEventBubblingHandler(n)),null!=e&&this.listenTo(e,"all",this._getCachedEventBubblingHandler(n))}}};k.extend=function(e){var t,n=this;t=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return n.apply(this,arguments)},o(t,n);var r=function(){this.constructor=t};if(r.prototype=n.prototype,t.prototype=new r,t.prototype._derived=o({},n.prototype._derived),t.prototype._deps=o({},n.prototype._deps),t.prototype._definition=o({},n.prototype._definition),t.prototype._collections=o({},n.prototype._collections),t.prototype._children=o({},n.prototype._children),t.prototype._dataTypes=o({},n.prototype._dataTypes||S),e)for(var i=["dataTypes","props","session","derived","collections","children"],a=0;a<arguments.length;a++){var l=arguments[a];l.dataTypes&&c(l.dataTypes,(function(e,n){t.prototype._dataTypes[n]=e})),l.props&&c(l.props,(function(e,n){E(t.prototype,n,e)})),l.session&&c(l.session,(function(e,n){E(t.prototype,n,e,!0)})),l.derived&&c(l.derived,(function(e,n){C(t.prototype,n,e)})),l.collections&&c(l.collections,(function(e,n){t.prototype._collections[n]=e})),l.children&&c(l.children,(function(e,n){t.prototype._children[n]=e})),o(t.prototype,s(l,i))}return t.__super__=n.prototype,t},e.exports=k},function(e,t,n){var r=n(74),o=n(195),i=n(4);e.exports=function(e){return i(e)?r(e,!0):o(e)}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var r=n(58),o=n(59),i=n(57),s=n(92),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,i(e)),e=o(e);return t}:s;e.exports=a},function(e,t,n){var r=n(95),o=n(57),i=n(5);e.exports=function(e){return r(e,i,o)}},function(e,t,n){var r=n(58),o=n(1);e.exports=function(e,t,n){var i=t(e);return o(e)?i:r(i,n(e))}},function(e,t,n){var r=n(95),o=n(93),i=n(91);e.exports=function(e){return r(e,i,o)}},function(e,t,n){var r=n(0).Uint8Array;e.exports=r},function(e,t,n){var r=n(42),o=n(216);e.exports=function(e,t){return t.length<2?e:r(e,o(t,0,-1))}},function(e,t,n){var r=n(100),o=n(82),i=n(51);e.exports=function(e){return i(o(e,void 0,r),e+"")}},function(e,t,n){var r=n(63);e.exports=function(e){return(null==e?0:e.length)?r(e,1):[]}},function(e,t,n){var r=n(102),o=n(225),i=n(226);e.exports=function(e,t,n){return t==t?i(e,t,n):r(e,o,n)}},function(e,t){e.exports=function(e,t,n,r){for(var o=e.length,i=n+(r?1:-1);r?i--:++i<o;)if(t(e[i],i,e))return i;return-1}},function(e,t,n){var r=n(65),o=n(233),i=n(66),s=1,a=2;e.exports=function(e,t,n,c,l,u){var f=n&s,d=e.length,p=t.length;if(d!=p&&!(f&&p>d))return!1;var h=u.get(e);if(h&&u.get(t))return h==t;var v=-1,m=!0,g=n&a?new r:void 0;for(u.set(e,t),u.set(t,e);++v<d;){var _=e[v],b=t[v];if(c)var y=f?c(b,_,v,t,e,u):c(_,b,v,e,t,u);if(void 0!==y){if(y)continue;m=!1;break}if(g){if(!o(t,(function(e,t){if(!i(g,t)&&(_===e||l(_,e,n,c,u)))return g.push(t)}))){m=!1;break}}else if(_!==b&&!l(_,b,n,c,u)){m=!1;break}}return u.delete(e),u.delete(t),m}},function(e,t,n){var r=n(8),o=n(27),i=n(1),s=n(18),a=n(49),c=n(9);e.exports=function(e,t,n){for(var l=-1,u=(t=r(t,e)).length,f=!1;++l<u;){var d=c(t[l]);if(!(f=null!=e&&n(e,d)))break;e=e[d]}return f||++l!=u?f:!!(u=null==e?0:e.length)&&a(u)&&s(d,u)&&(i(e)||o(e))}},function(e,t,n){var r=n(8),o=n(30),i=n(9);e.exports=function(e,t,n){var s=-1,a=(t=r(t,e)).length;for(a||(a=1,e=void 0);++s<a;){var c=null==e?void 0:e[i(t[s])];void 0===c&&(s=a,c=n),e=o(c)?c.call(e):c}return e}},function(e,t){e.exports=function(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1}},function(e,t){e.exports=function(){}},function(e,t,n){var r=n(4),o=n(2);e.exports=function(e){return o(e)&&r(e)}},function(e,t){var n=Array.prototype.slice;function r(e){if("object"!=typeof(e=e||{}))throw new TypeError("Options must be an object");this.storage={},this.separator=e.separator||"."}r.prototype.add=function(e,t){(this.storage[e]||(this.storage[e]=[])).push(t)},r.prototype.remove=function(e){var t,n;for(t in this.storage)(n=this.storage[t]).some((function(t,r){if(t===e)return n.splice(r,1),!0}))},r.prototype.get=function(e){var t,n=[];for(t in this.storage)e&&e!==t&&0!==t.indexOf(e+this.separator)||(n=n.concat(this.storage[t]));return n},r.prototype.getGrouped=function(e){var t,r={};for(t in this.storage)e&&e!==t&&0!==t.indexOf(e+this.separator)||(r[t]=n.call(this.storage[t]));return r},r.prototype.getAll=function(e){var t,r={};for(t in this.storage)e!==t&&0!==t.indexOf(e+this.separator)||(r[t]=n.call(this.storage[t]));return r},r.prototype.run=function(e,t){var r=n.call(arguments,2);this.get(e).forEach((function(e){e.apply(t||this,r)}))},e.exports=r},function(e,t,n){var r=n(22),o=n(85),i=n(244),s=n(17),a=n(4),c=s((function(e,t,n){var s=-1,c="function"==typeof t,l=a(e)?Array(e.length):[];return o(e,(function(e){l[++s]=c?r(t,e,n):i(e,t,n)})),l}));e.exports=c},function(e,t,n){var r=n(245),o=n(99)((function(e,t){return null==e?{}:r(e,t)}));e.exports=o},function(e,t,n){var r=n(248),o=n(104);e.exports=function(e,t){return null!=e&&o(e,t,r)}},function(e,t,n){var r=n(251),o=n(254),i=n(21),s=n(1),a=n(255);e.exports=function(e){return"function"==typeof e?e:null==e?i:"object"==typeof e?s(e)?o(e[0],e[1]):r(e):a(e)}},function(e,t,n){var r=n(3);e.exports=function(e){return e==e&&!r(e)}},function(e,t){e.exports=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}},function(e,t,n){var r=n(42);e.exports=function(e,t,n){var o=null==e?void 0:r(e,t);return void 0===o?n:o}},function(e,t,n){var r=n(17),o=n(118),i=n(44),s=n(23),a=r((function(e,t,n){var r=1;if(n.length){var c=s(n,i(a));r|=32}return o(e,r,t,n,c)}));a.placeholder={},e.exports=a},function(e,t,n){var r=n(119),o=n(261),i=n(262),s=n(121),a=n(273),c=n(125),l=n(274),u=n(127),f=n(128),d=n(24),p="Expected a function",h=1,v=2,m=8,g=16,_=32,b=64,y=Math.max;e.exports=function(e,t,n,w,x,k,E,C){var S=t&v;if(!S&&"function"!=typeof e)throw new TypeError(p);var M=w?w.length:0;if(M||(t&=~(_|b),w=x=void 0),E=void 0===E?E:y(d(E),0),C=void 0===C?C:d(C),M-=x?x.length:0,t&b){var A=w,j=x;w=x=void 0}var O=S?void 0:c(e),T=[e,t,n,w,x,A,j,k,E,C];if(O&&l(T,O),e=T[0],t=T[1],n=T[2],w=T[3],x=T[4],!(C=T[9]=void 0===T[9]?S?0:e.length:y(T[9]-M,0))&&t&(m|g)&&(t&=~(m|g)),t&&t!=h)$=t==m||t==g?i(e,t,C):t!=_&&t!=(h|_)||x.length?s.apply(void 0,T):a(e,t,n,w);else var $=o(e,t,n);return f((O?r:u)($,T),e,t)}},function(e,t,n){var r=n(21),o=n(120),i=o?function(e,t){return o.set(e,t),e}:r;e.exports=i},function(e,t,n){var r=n(79),o=r&&new r;e.exports=o},function(e,t,n){var r=n(122),o=n(123),i=n(263),s=n(43),a=n(124),c=n(44),l=n(272),u=n(23),f=n(0),d=1,p=2,h=8,v=16,m=128,g=512;e.exports=function e(t,n,_,b,y,w,x,k,E,C){var S=n&m,M=n&d,A=n&p,j=n&(h|v),O=n&g,T=A?void 0:s(t);return function d(){for(var p=arguments.length,h=Array(p),v=p;v--;)h[v]=arguments[v];if(j)var m=c(d),g=i(h,m);if(b&&(h=r(h,b,y,j)),w&&(h=o(h,w,x,j)),p-=g,j&&p<C){var $=u(h,m);return a(t,n,e,d.placeholder,_,h,$,k,E,C-p)}var P=M?_:this,N=A?P[t]:t;return p=h.length,k?h=l(h,k):O&&p>1&&h.reverse(),S&&E<p&&(h.length=E),this&&this!==f&&this instanceof d&&(N=T||s(N)),N.apply(P,h)}}},function(e,t){var n=Math.max;e.exports=function(e,t,r,o){for(var i=-1,s=e.length,a=r.length,c=-1,l=t.length,u=n(s-a,0),f=Array(l+u),d=!o;++c<l;)f[c]=t[c];for(;++i<a;)(d||i<s)&&(f[r[i]]=e[i]);for(;u--;)f[c++]=e[i++];return f}},function(e,t){var n=Math.max;e.exports=function(e,t,r,o){for(var i=-1,s=e.length,a=-1,c=r.length,l=-1,u=t.length,f=n(s-c,0),d=Array(f+u),p=!o;++i<f;)d[i]=e[i];for(var h=i;++l<u;)d[h+l]=t[l];for(;++a<c;)(p||i<s)&&(d[h+r[a]]=e[i++]);return d}},function(e,t,n){var r=n(264),o=n(127),i=n(128),s=1,a=2,c=4,l=8,u=32,f=64;e.exports=function(e,t,n,d,p,h,v,m,g,_){var b=t&l;t|=b?u:f,(t&=~(b?f:u))&c||(t&=~(s|a));var y=[e,t,p,b?h:void 0,b?v:void 0,b?void 0:h,b?void 0:v,m,g,_],w=n.apply(void 0,y);return r(e)&&o(w,y),w.placeholder=d,i(w,e,t)}},function(e,t,n){var r=n(120),o=n(107),i=r?function(e){return r.get(e)}:o;e.exports=i},function(e,t,n){var r=n(41),o=n(70);function i(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}i.prototype=r(o.prototype),i.prototype.constructor=i,e.exports=i},function(e,t,n){var r=n(119),o=n(83)(r);e.exports=o},function(e,t,n){var r=n(269),o=n(270),i=n(51),s=n(271);e.exports=function(e,t,n){var a=t+"";return i(e,o(a,s(r(a),n)))}},function(e,t){var n=window.addEventListener?"addEventListener":"attachEvent",r=window.removeEventListener?"removeEventListener":"detachEvent",o="addEventListener"!==n?"on":"";t.bind=function(e,t,r,i){return e[n](o+t,r,i||!1),r},t.unbind=function(e,t,n,i){return e[r](o+t,n,i||!1),n}},function(e,t,n){"use strict";var r="undefined"!=typeof Element?Element.prototype:{},o=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector;e.exports=function(e,t){if(!e||1!==e.nodeType)return!1;if(o)return o.call(e,t);for(var n=e.parentNode.querySelectorAll(t),r=0;r<n.length;r++)if(n[r]==e)return!0;return!1}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.HandlebarsEnvironment=l;var o=n(6),i=r(n(13)),s=n(132),a=n(294),c=r(n(296));t.VERSION="4.5.3";t.COMPILER_REVISION=8;t.LAST_COMPATIBLE_COMPILER_REVISION=7;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};function l(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},s.registerDefaultHelpers(this),a.registerDefaultDecorators(this)}l.prototype={constructor:l,logger:c.default,log:c.default.log,registerHelper:function(e,t){if("[object Object]"===o.toString.call(e)){if(t)throw new i.default("Arg not supported with multiple helpers");o.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===o.toString.call(e))o.extend(this.partials,e);else{if(void 0===t)throw new i.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if("[object Object]"===o.toString.call(e)){if(t)throw new i.default("Arg not supported with multiple decorators");o.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};var u=c.default.log;t.log=u,t.createFrame=o.createFrame,t.logger=c.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.registerDefaultHelpers=function(e){o.default(e),i.default(e),s.default(e),a.default(e),c.default(e),l.default(e),u.default(e)},t.moveHelperToHooks=function(e,t,n){e.helpers[t]&&(e.hooks[t]=e.helpers[t],n||delete e.helpers[t])};var o=r(n(287)),i=r(n(288)),s=r(n(289)),a=r(n(290)),c=r(n(291)),l=r(n(292)),u=r(n(293))},function(e,t,n){"use strict";var r=n(10),o=n(168),i=n(242),s=n(304),a=n(307),c=n(310),l=n(313),u=n(71),f=n(72);r.extend({init:function(){var e=o;this.extend({GAME:e.resetModel("Game_state"),settings:e.resetModel("Settings"),moves:e.resetModel("Moves"),history:e.resetModel("History"),opening:e.resetModel("Opening"),openings:e.resetModel("Openings"),chess:new Chess,board:null,review_board:null,kibitz_board:null,fen_board:null,sm_chart:null,engine_moves:e.resetModel("Engine"),resetModel:e.resetModel.bind(e),ga:l,cfg:{api:"https://dbapi.chessui.com/",paths:{lc0:"lc0",syg:"sz",book:"op",data:"db"}}});var t=n(314),d=n(315);t("CE","LCE_SF"),t("Eval","Eval_SF",!0),this.boardFn=d,d.init([{name:"board",config:{}},{name:"review_board",config:{draggable:!1}},{name:"kibitz_board",config:{draggable:!1,moveSpeed:"fast"}}],r),this.listenTo(this.settings,"change",this.saveLocal("settings")),this.settings_view=new i({model:r.settings,app:r}),this.moves_list=new s({model:r.moves,app:r}),this.openings_view=new a({model:r.opening,app:r}),this.ECO=n(316)(this.opening,this.moves_list,c.resolveOpeningState,c.renderBook.bind(c),f),c.init(),$(window).resize(r.board.resize),$("#board").on("touchmove",(function(e){e.preventDefault()}));$("#kibitz").on("mouseenter",(function(e){if(e.target){var t=$(e.target).data("fen");t?($("#kibitz_board_wrap").addClass("show"),r.kibitz_board.position(t)):$("#kibitz_board_wrap").removeClass("shown")}})).on("mouseleave",(function(e){$("#kibitz_board_wrap").removeClass("show")})).on("mousemove",u((function(e){if(e.target){var t=$(e.target).data("fen");t&&($("#kibitz_board_wrap").addClass("show"),r.kibitz_board.position(t))}}),30))},saveLocal:function(e){return function(t){var n=t.serialize(),r=JSON.stringify(n);localStorage.setItem("chess_".concat(e),r)}}}),r.init(),window._App=r,e.exports=r,"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("../service-worker.js").then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){switch(t.state){case"installed":navigator.serviceWorker.controller?console.log("New or updated content is available."):console.log("Content is now available offline!");break;case"redundant":console.error("The installing service worker became redundant.")}}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}))},function(e,t,n){var r=n(135);e.exports=function(e){return r(2,e)}},function(e,t,n){var r=n(24),o="Expected a function";e.exports=function(e,t){var n;if("function"!=typeof t)throw new TypeError(o);return e=r(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}},function(e,t,n){var r=n(137),o=1/0,i=17976931348623157e292;e.exports=function(e){return e?(e=r(e))===o||e===-o?(e<0?-1:1)*i:e==e?e:0:0===e?e:0}},function(e,t,n){var r=n(3),o=n(25),i=NaN,s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return i;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=c.test(e);return n||l.test(e)?u(e.slice(2),n?2:8):a.test(e)?i:+e}},function(e,t,n){var r=n(11),o=Object.prototype,i=o.hasOwnProperty,s=o.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=i.call(e,a),n=e[a];try{e[a]=void 0;var r=!0}catch(e){}var o=s.call(e);return r&&(t?e[a]=n:delete e[a]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(7),o=n(2),i="[object Arguments]";e.exports=function(e){return o(e)&&r(e)==i}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(7),o=n(49),i=n(2),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&o(e.length)&&!!s[r(e)]}},function(e,t,n){var r=n(76)(Object.keys,Object);e.exports=r},function(e,t,n){var r=n(75),o=n(14),i=n(27),s=n(1),a=n(4),c=n(28),l=n(20),u=n(48),f="[object Map]",d="[object Set]",p=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(s(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||u(e)||i(e)))return!e.length;var t=o(e);if(t==f||t==d)return!e.size;if(l(e))return!r(e).length;for(var n in e)if(p.call(e,n))return!1;return!0}},function(e,t,n){var r=n(12)(n(0),"DataView");e.exports=r},function(e,t,n){var r=n(30),o=n(148),i=n(3),s=n(77),a=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,f=l.hasOwnProperty,d=RegExp("^"+u.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||o(e))&&(r(e)?d:a).test(s(e))}},function(e,t,n){var r,o=n(149),i=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!i&&i in e}},function(e,t,n){var r=n(0)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(12)(n(0),"Promise");e.exports=r},function(e,t,n){var r=n(17),o=n(155);e.exports=function(e){return r((function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,a&&o(n[0],n[1],a)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var c=n[r];c&&e(t,c,r,s)}return t}))}},function(e,t,n){var r=n(154),o=n(81),i=n(21),s=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:i;e.exports=s},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,n){var r=n(32),o=n(4),i=n(18),s=n(3);e.exports=function(e,t,n){if(!s(n))return!1;var a=typeof t;return!!("number"==a?o(n)&&i(t,n.length):"string"==a&&t in n)&&r(n[t],e)}},function(e,t,n){var r=n(157)();e.exports=r},function(e,t){e.exports=function(e){return function(t,n,r){for(var o=-1,i=Object(t),s=r(t),a=s.length;a--;){var c=s[e?a:++o];if(!1===n(i[c],c,i))break}return t}}},function(e,t,n){var r=n(4);e.exports=function(e,t){return function(n,o){if(null==n)return n;if(!r(n))return e(n,o);for(var i=n.length,s=t?i:-1,a=Object(n);(t?s--:++s<i)&&!1!==o(a[s],s,a););return n}}},function(e,t,n){var r=n(53),o=/\s+/;t.triggerEvents=function(e,t){var n,r=-1,o=e.length,i=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++r<o;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i,s);return;case 3:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i,s,a);return;default:for(;++r<o;)(n=e[r]).callback.apply(n.ctx,t);return}},t.eventsApi=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(o.test(n)){for(var s=n.split(o),a=0,c=s.length;a<c;a++)e[t].apply(e,[s[a]].concat(r));return!1}return!0},t.createListenMethod=function(e){return function(t,n,o){if(!t)throw new Error("Trying to listenTo event: '"+n+"' but the target object is undefined");if((this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=r("l"))]=t,o||"object"!=typeof n||(o=this),"function"!=typeof t[e])throw new Error("Trying to listenTo event: '"+n+"' on object: "+t.toString()+" but it does not have an 'on' method so is unbindable");return t[e](n,o,this),this}}},function(e,t,n){var r=n(11),o=n(33),i=n(1),s=n(25),a=1/0,c=r?r.prototype:void 0,l=c?c.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(i(t))return o(t,e)+"";if(s(t))return l?l.call(t):"";var n=t+"";return"0"==n&&1/t==-a?"-0":n}},function(e,t,n){var r=n(11),o=n(34),i=n(14),s=n(4),a=n(35),c=n(162),l=n(88),u=n(36),f=n(163),d=n(89),p="[object Map]",h="[object Set]",v=r?r.iterator:void 0;e.exports=function(e){if(!e)return[];if(s(e))return a(e)?f(e):o(e);if(v&&e[v])return c(e[v]());var t=i(e);return(t==p?l:t==h?u:d)(e)}},function(e,t){e.exports=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}},function(e,t,n){var r=n(164),o=n(165),i=n(166);e.exports=function(e){return o(e)?i(e):r(e)}},function(e,t){e.exports=function(e){return e.split("")}},function(e,t){var n=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return n.test(e)}},function(e,t){var n="[\\ud800-\\udfff]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\\ud83c[\\udffb-\\udfff]",i="[^\\ud800-\\udfff]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+r+"|"+o+")"+"?",l="[\\ufe0e\\ufe0f]?"+c+("(?:\\u200d(?:"+[i,s,a].join("|")+")[\\ufe0e\\ufe0f]?"+c+")*"),u="(?:"+[i+r+"?",r,s,a,n].join("|")+")",f=RegExp(o+"(?="+o+")|"+u+l,"g");e.exports=function(e){return e.match(f)||[]}},function(e,t,n){var r=n(33);e.exports=function(e,t){return r(t,(function(t){return e[t]}))}},function(e,t,n){"use strict";var r=n(90);function o(e){for(var t=e.length;t>0;){var n=Math.floor(Math.random()*t),r=e[--t];e[t]=e[n],e[n]=r}return e}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=new RegExp("^"+t),r=[];return(r=e.filter((function(e){return n.test(e.Moves)}))).length>0&&(r=o(r).slice()),r}var s=r.extend({props:{opening:"string",lines:"array",filtered:"array",use_filtered:"boolean",ECO:"string",variation:"string",active_line:"string",active_pos:"string",sel_move:"object",lock_move:"object",use_locked:"boolean",selected_arr:"array",$start:"object",started:"boolean",$def:"object",completed:"boolean",requested:"boolean",out_of_book:"boolean",options:"array"},derived:{pick:{deps:["lines","use_filtered","filtered"],fn:function(){var e=this.use_filtered?this.filtered:this.lines,t=e.length,n=e.slice(),r=[];return t>1&&(r=o(n).slice()),t>=1&&r.slice().pop()},cache:!1},opts:{deps:["options"],fn:function(){var e=this.options,t=[],n=e.length;n&&n>0&&(t=o(e.slice()).slice());return t.pop()},cache:!1},findFiltered:{deps:["lines","use_filtered","filtered","active_pos"],fn:function(){var e=this.active_pos,t=[];return this.filtered&&this.filtered.length>0&&(t=i(this.filtered,e)),t},cache:!1},findAll:{deps:["lines","active_pos"],fn:function(){var e=this.active_pos;return i(this.lines,e)},cache:!1},active_arr:{deps:["active_line"],fn:function(){return this.active_line.split(" ")},cache:!1}}}),a=r.extend({extraProperties:"allow",props:{in_progress:"boolean",turn:"string",result:"number",player_name:"string",rand_max:"number",player_turn:"boolean",check_local_book:"boolean",local_book_deferred:"object",allow_leela:"boolean",opponent_is_engine:"boolean",opponent_name:"string",opponent_type:"string",game_state:"string",opening:"string",game_actions:"array",game_available_actions:"array",custom_FEN:"string",custom_game:"boolean"},derived:{rand_engine:{deps:["rand_max"],fn:function(){return e=this.rand_max,Math.floor(Math.random()*Math.floor(e));var e}},isMobile:{fn:function(){return window.matchMedia("only screen and (max-width: 760px)").matches}},use_remote:{fn:function(){return Math.round(Math.random())}},waiting_for_engine:{deps:["player_turn","opponent_is_engine"],fn:function(){return this.player_turn&&this.opponent_is_engine}}}}),c=r.extend({props:{openings:"array",active_line:"array"},derived:{active_line_str:{deps:["active_line"],fn:function(){return this.active_line.join(" ")}},subset:{deps:["openings"],fn:function(){return this.openings.slice(0,350)},cache:!1},pick:{deps:["openings"],fn:function(){return this.openings.length>0&&this.openings[0]},cache:!1},setString:{deps:["openings"],fn:function(){return this.openings.length>350?"+":""}}}}),l=r.extend({}),u=r.extend({props:{previousSet:"array",moves:"array",FEN_positions:"array",score_sequence:"array"}}),f=r.extend({props:{currentFEN:"string",move_list:"array",SAN_move_list:"array",player_move:"string",engine_move:"string",ponder_list:"array",opponent_move:"string",engine_moves:"array",FEN_positions:"array",engine_scores:"array",player_captures:"array",engine_captures:"array"},derived:{move_number:{deps:["move_list"],fn:function(){return this.move_list.length},cache:!1},is_empty:{deps:["move_list"],fn:function(){return 0===this.move_list.length},cache:!1},half_move:{deps:["move_list"],fn:function(){return this.move_list.length%2==0},cache:!1},player_material:{deps:["player_captures"],fn:function(){var e={p:1,b:3,n:3,r:5,q:9};return this.player_captures.map((function(t){return e[t]||0}))},cache:!1},engine_material:{deps:["engine_captures"],fn:function(){var e={p:1,b:3,n:3,r:5,q:9};return this.engine_captures.map((function(t){return e[t]||0}))},cache:!1},player_material_total:{deps:["player_material","engine_material"],fn:function(){return this.player_material.reduce((function(e,t){return e+t}),0)-this.engine_material.reduce((function(e,t){return e+t}),0)},cache:!1},SAN_moves_string:{deps:["SAN_move_list"],fn:function(){return this.SAN_move_list.map((function(e){return e.w+(e.b?" "+e.b:"")})).join(" ")},cache:!1}}}),d=r.extend({props:{time_option:"string",max_depth:"number",strength:"number",contempt:"number",strength_profile:"number",cloud_engine:"boolean",show_legal:"boolean",show_last_enginemove:"boolean",board_color:"string",pieces:"string",player_color:"string",player_name:"string",board_size:"number",show_kibitz:"boolean",show_UCI:"boolean",material_odds:"string",show_possible_moves:"boolean",preferred_style:"string",preferred_eco:"string"},derived:{flip:{deps:["player_color"],fn:function(){return"w"!==this.player_color}},engine_color:{deps:["player_color"],fn:function(){return"w"===this.player_color?"b":"w"}},play_as_white:{deps:["player_color"],fn:function(){return"w"===this.player_color}}}}),p=r.extend({extraProperties:"ignore",props:{move:"string",line:"string",score:"number",kibitz:"string",move_set:"array",kibitz_array:"array",simple_lines:"array",SAN_kibitz:"array",lines:"array"}});e.exports={Game_state:a,Moves:f,History:u,Settings:d,Engine:p,Opening:s,Openings:c,Analysis:l,resetModel:function(e){var t=null;if(e in this){if("Settings"===e){var n=localStorage.getItem("chess_".concat(e.toLowerCase()));n&&(t=JSON.parse(n))}var r=t?$.extend(this.cleanData(e),t):this.cleanData(e);return new this[e](r)}return{}},cleanData:function(e){var t={Engine:{move:"",line:"",score:0,kibitz:"",move_set:[],kibitz_array:[],simple_lines:[],SAN_kibitz:[],lines:[]},History:{previousSet:[],moves:[],FEN_positions:[],score_sequence:[]},Moves:{currentFEN:"",move_list:[],SAN_move_list:[],player_move:"",engine_move:"",opponent_move:"",engine_moves:[],ponder_list:[],FEN_positions:[],engine_scores:[],player_captures:[],engine_captures:[]},Openings:{openings:[],active_line:[]},Opening:{opening:"",ECO:"",use_filtered:!1,variation:"",active_line:"",active_pos:"",sel_move:{},lock_move:{},$def:$.Deferred(),completed:!1,requested:!1,out_of_book:!1},Settings:{time_option:"5v5",max_depth:10,strength:5,contempt:25,strength_profile:1600,cloud_engine:!1,show_legal:!0,show_last_enginemove:!0,pieces:"default",board_color:"default",player_color:"w",player_name:"Human Player",board_size:400,show_kibitz:!0,show_UCI:!1,material_odds:"none",show_possible_moves:!0,preferred_eco:"",preferred_style:"default"},Game_state:{in_progress:!1,turn:"w",player_turn:!0,result:0,waiting_for_engine:!1,check_local_book:!0,local_book_deferred:{},player_name:"player",allow_leela:!0,opponent_is_engine:!0,opponent_name:"Stockfish 10",opponent_type:"engine",opening:"",game_state:"new",game_actions:["start","resign","offer draw"],game_available_actions:[],custom_FEN:"",custom_game:!1}};return e in t?t[e]:{}}}},function(e,t,n){var r=n(33),o=n(170),i=n(212),s=n(8),a=n(16),c=n(217),l=n(99),u=n(96),f=l((function(e,t){var n={};if(null==e)return n;var l=!1;t=r(t,(function(t){return t=s(t,e),l||(l=t.length>1),t})),a(e,u(e),n),l&&(n=o(n,7,c));for(var f=t.length;f--;)i(n,t[f]);return n}));e.exports=f},function(e,t,n){var r=n(55),o=n(52),i=n(31),s=n(193),a=n(194),c=n(197),l=n(34),u=n(198),f=n(200),d=n(94),p=n(96),h=n(14),v=n(201),m=n(202),g=n(207),_=n(1),b=n(28),y=n(208),w=n(3),x=n(210),k=n(5),E=1,C=2,S=4,M="[object Arguments]",A="[object Function]",j="[object GeneratorFunction]",O="[object Object]",T={};T[M]=T["[object Array]"]=T["[object ArrayBuffer]"]=T["[object DataView]"]=T["[object Boolean]"]=T["[object Date]"]=T["[object Float32Array]"]=T["[object Float64Array]"]=T["[object Int8Array]"]=T["[object Int16Array]"]=T["[object Int32Array]"]=T["[object Map]"]=T["[object Number]"]=T[O]=T["[object RegExp]"]=T["[object Set]"]=T["[object String]"]=T["[object Symbol]"]=T["[object Uint8Array]"]=T["[object Uint8ClampedArray]"]=T["[object Uint16Array]"]=T["[object Uint32Array]"]=!0,T["[object Error]"]=T[A]=T["[object WeakMap]"]=!1,e.exports=function e(t,n,$,P,N,D){var L,F=n&E,q=n&C,I=n&S;if($&&(L=N?$(t,P,N,D):$(t)),void 0!==L)return L;if(!w(t))return t;var B=_(t);if(B){if(L=v(t),!F)return l(t,L)}else{var z=h(t),R=z==A||z==j;if(b(t))return c(t,F);if(z==O||z==M||R&&!N){if(L=q||R?{}:g(t),!F)return q?f(t,a(L,t)):u(t,s(L,t))}else{if(!T[z])return N?t:{};L=m(t,z,F)}}D||(D=new r);var H=D.get(t);if(H)return H;D.set(t,L),x(t)?t.forEach((function(r){L.add(e(r,n,$,r,t,D))})):y(t)&&t.forEach((function(r,o){L.set(o,e(r,n,$,o,t,D))}));var G=I?q?p:d:q?keysIn:k,V=B?void 0:G(t);return o(V||t,(function(r,o){V&&(r=t[o=r]),i(L,o,e(r,n,$,o,t,D))})),L}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(38),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():o.call(t,n,1),--this.size,!0)}},function(e,t,n){var r=n(38);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(38);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(38);e.exports=function(e,t){var n=this.__data__,o=r(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this}},function(e,t,n){var r=n(37);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(37),o=n(50),i=n(56),s=200;e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!o||a.length<s-1)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new i(a)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(182),o=n(37),i=n(50);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||o),string:new r}}},function(e,t,n){var r=n(183),o=n(184),i=n(185),s=n(186),a=n(187);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,n){var r=n(39);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(39),o="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return n===o?void 0:n}return i.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(39),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:o.call(t,e)}},function(e,t,n){var r=n(39),o="__lodash_hash_undefined__";e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?o:t,this}},function(e,t,n){var r=n(40);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(40);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(40);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(40);e.exports=function(e,t){var n=r(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this}},function(e,t,n){var r=n(16),o=n(5);e.exports=function(e,t){return e&&r(t,o(t),e)}},function(e,t,n){var r=n(16),o=n(91);e.exports=function(e,t){return e&&r(t,o(t),e)}},function(e,t,n){var r=n(3),o=n(20),i=n(196),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=o(e),n=[];for(var a in e)("constructor"!=a||!t&&s.call(e,a))&&n.push(a);return n}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){(function(e){var r=n(0),o=t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=i&&i.exports===o?r.Buffer:void 0,a=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}}).call(this,n(47)(e))},function(e,t,n){var r=n(16),o=n(57);e.exports=function(e,t){return r(e,o(e),t)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var s=e[n];t(s,n,e)&&(i[o++]=s)}return i}},function(e,t,n){var r=n(16),o=n(93);e.exports=function(e,t){return r(e,o(e),t)}},function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&n.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},function(e,t,n){var r=n(60),o=n(203),i=n(204),s=n(205),a=n(206),c="[object Boolean]",l="[object Date]",u="[object Map]",f="[object Number]",d="[object RegExp]",p="[object Set]",h="[object String]",v="[object Symbol]",m="[object ArrayBuffer]",g="[object DataView]",_="[object Float32Array]",b="[object Float64Array]",y="[object Int8Array]",w="[object Int16Array]",x="[object Int32Array]",k="[object Uint8Array]",E="[object Uint8ClampedArray]",C="[object Uint16Array]",S="[object Uint32Array]";e.exports=function(e,t,n){var M=e.constructor;switch(t){case m:return r(e);case c:case l:return new M(+e);case g:return o(e,n);case _:case b:case y:case w:case x:case k:case E:case C:case S:return a(e,n);case u:return new M;case f:case h:return new M(e);case d:return i(e);case p:return new M;case v:return s(e)}}},function(e,t,n){var r=n(60);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},function(e,t){var n=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,n.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,n){var r=n(11),o=r?r.prototype:void 0,i=o?o.valueOf:void 0;e.exports=function(e){return i?Object(i.call(e)):{}}},function(e,t,n){var r=n(60);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},function(e,t,n){var r=n(41),o=n(59),i=n(20);e.exports=function(e){return"function"!=typeof e.constructor||i(e)?{}:r(o(e))}},function(e,t,n){var r=n(209),o=n(19),i=n(29),s=i&&i.isMap,a=s?o(s):r;e.exports=a},function(e,t,n){var r=n(14),o=n(2),i="[object Map]";e.exports=function(e){return o(e)&&r(e)==i}},function(e,t,n){var r=n(211),o=n(19),i=n(29),s=i&&i.isSet,a=s?o(s):r;e.exports=a},function(e,t,n){var r=n(14),o=n(2),i="[object Set]";e.exports=function(e){return o(e)&&r(e)==i}},function(e,t,n){var r=n(8),o=n(62),i=n(98),s=n(9);e.exports=function(e,t){return t=r(t,e),null==(e=i(e,t))||delete e[s(o(t))]}},function(e,t,n){var r=n(214),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,s=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(o,(function(e,n,r,o){t.push(r?o.replace(i,"$1"):n||e)})),t}));e.exports=s},function(e,t,n){var r=n(215),o=500;e.exports=function(e){var t=r(e,(function(e){return n.size===o&&n.clear(),e})),n=t.cache;return t}},function(e,t,n){var r=n(56),o="Expected a function";function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(o);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=e.apply(this,r);return n.cache=i.set(o,s)||i,s};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},function(e,t){e.exports=function(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(o);++r<o;)i[r]=e[r+t];return i}},function(e,t,n){var r=n(218);e.exports=function(e){return r(e)?void 0:e}},function(e,t,n){var r=n(7),o=n(59),i=n(2),s="[object Object]",a=Function.prototype,c=Object.prototype,l=a.toString,u=c.hasOwnProperty,f=l.call(Object);e.exports=function(e){if(!i(e)||r(e)!=s)return!1;var t=o(e);if(null===t)return!0;var n=u.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&l.call(n)==f}},function(e,t,n){var r=n(11),o=n(27),i=n(1),s=r?r.isConcatSpreadable:void 0;e.exports=function(e){return i(e)||o(e)||!!(s&&e&&e[s])}},function(e,t,n){var r=n(221),o=n(54),i=/[&<>"']/g,s=RegExp(i.source);e.exports=function(e){return(e=o(e))&&s.test(e)?e.replace(i,r):e}},function(e,t,n){var r=n(222)({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=r},function(e,t){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},function(e,t,n){var r=n(86),o=n(87);e.exports=function(e,t){return e&&r(e,o(t))}},function(e,t,n){var r=n(101),o=n(4),i=n(35),s=n(24),a=n(89),c=Math.max;e.exports=function(e,t,n,l){e=o(e)?e:a(e),n=n&&!l?s(n):0;var u=e.length;return n<0&&(n=c(u+n,0)),i(e)?n<=u&&e.indexOf(t,n)>-1:!!u&&r(e,t,n)>-1}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,n){for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}},function(e,t,n){var r=n(228),o=n(19),i=n(29),s=i&&i.isDate,a=s?o(s):r;e.exports=a},function(e,t,n){var r=n(7),o=n(2),i="[object Date]";e.exports=function(e){return o(e)&&r(e)==i}},function(e,t,n){var r=n(64);e.exports=function(e,t){return r(e,t)}},function(e,t,n){var r=n(55),o=n(103),i=n(234),s=n(235),a=n(14),c=n(1),l=n(28),u=n(48),f=1,d="[object Arguments]",p="[object Array]",h="[object Object]",v=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,m,g,_){var b=c(e),y=c(t),w=b?p:a(e),x=y?p:a(t),k=(w=w==d?h:w)==h,E=(x=x==d?h:x)==h,C=w==x;if(C&&l(e)){if(!l(t))return!1;b=!0,k=!1}if(C&&!k)return _||(_=new r),b||u(e)?o(e,t,n,m,g,_):i(e,t,w,n,m,g,_);if(!(n&f)){var S=k&&v.call(e,"__wrapped__"),M=E&&v.call(t,"__wrapped__");if(S||M){var A=S?e.value():e,j=M?t.value():t;return _||(_=new r),g(A,j,n,m,_)}}return!!C&&(_||(_=new r),s(e,t,n,m,g,_))}},function(e,t){var n="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,n),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t,n){var r=n(11),o=n(97),i=n(32),s=n(103),a=n(88),c=n(36),l=1,u=2,f="[object Boolean]",d="[object Date]",p="[object Error]",h="[object Map]",v="[object Number]",m="[object RegExp]",g="[object Set]",_="[object String]",b="[object Symbol]",y="[object ArrayBuffer]",w="[object DataView]",x=r?r.prototype:void 0,k=x?x.valueOf:void 0;e.exports=function(e,t,n,r,x,E,C){switch(n){case w:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y:return!(e.byteLength!=t.byteLength||!E(new o(e),new o(t)));case f:case d:case v:return i(+e,+t);case p:return e.name==t.name&&e.message==t.message;case m:case _:return e==t+"";case h:var S=a;case g:var M=r&l;if(S||(S=c),e.size!=t.size&&!M)return!1;var A=C.get(e);if(A)return A==t;r|=u,C.set(e,t);var j=s(S(e),S(t),r,x,E,C);return C.delete(e),j;case b:if(k)return k.call(e)==k.call(t)}return!1}},function(e,t,n){var r=n(94),o=1,i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,s,a,c){var l=n&o,u=r(e),f=u.length;if(f!=r(t).length&&!l)return!1;for(var d=f;d--;){var p=u[d];if(!(l?p in t:i.call(t,p)))return!1}var h=c.get(e);if(h&&c.get(t))return h==t;var v=!0;c.set(e,t),c.set(t,e);for(var m=l;++d<f;){var g=e[p=u[d]],_=t[p];if(s)var b=l?s(_,g,p,t,e,c):s(g,_,p,e,t,c);if(!(void 0===b?g===_||a(g,_,n,s,c):b)){v=!1;break}m||(m="constructor"==p)}if(v&&!m){var y=e.constructor,w=t.constructor;y!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof w&&w instanceof w)&&(v=!1)}return c.delete(e),c.delete(t),v}},function(e,t,n){var r=n(237),o=n(104);e.exports=function(e,t){return null!=e&&o(e,t,r)}},function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=function(e,t){return null!=e&&n.call(e,t)}},function(e,t,n){var r=n(63),o=n(17),i=n(239),s=n(108),a=o((function(e){return i(r(e,1,s,!0))}));e.exports=a},function(e,t,n){var r=n(65),o=n(67),i=n(106),s=n(66),a=n(240),c=n(36),l=200;e.exports=function(e,t,n){var u=-1,f=o,d=e.length,p=!0,h=[],v=h;if(n)p=!1,f=i;else if(d>=l){var m=t?null:a(e);if(m)return c(m);p=!1,f=s,v=new r}else v=t?[]:h;e:for(;++u<d;){var g=e[u],_=t?t(g):g;if(g=n||0!==g?g:0,p&&_==_){for(var b=v.length;b--;)if(v[b]===_)continue e;t&&v.push(_),h.push(g)}else f(v,_,n)||(v!==h&&v.push(_),h.push(g))}return h}},function(e,t,n){var r=n(78),o=n(107),i=n(36),s=r&&1/i(new r([,-0]))[1]==1/0?function(e){return new r(e)}:o;e.exports=s},function(e,t){e.exports=function(e,t){var n=e.length,r=e.indexOf(t)+1;return r>n-1&&(r=0),e[r]}},function(e,t,n){"use strict";var r=n(10),o=n(68),i=n(284),s=n(300),a=n(302),c=n(303);e.exports=o.extend({template:i,player_template:s,$el:$("#game-settings"),$player_el:$("#player-color"),$show_legal:$("#show_legal"),$cloud_engine:$("#cloud_engine"),update:function(e){var t,n=e.target.value,o=e.target.name;switch(e.target.type){case"number":t=Number(n);break;case"checkbox":t=n=e.target.checked,e.stopPropagation()}r.ga.event(o,t),"strength"===o&&(t>20&&(t=20),t<=0&&(t=1)),this.model[o]=t},updateStrength:function(e){e.target.val;var t=1900;try{t=Number.parseInt(e.target.value)}catch(e){console.error("Setting a default strength")}this.model.set("strength_profile",t),r.ga.event("strength_profile",t),localStorage.setItem("strength_profile",t)},getOldSettings:function(e){var t,n=localStorage.engineStrength,r=localStorage.engineDepth,o=localStorage.getItem("strength_profile")||1600;try{t=Number.parseInt(o)}catch(e){}e.set("strength_profile",t),n&&r&&(e.set("strength",Number(n)),e.set("max_depth",Number(r)),localStorage.removeItem("engineDepth"),localStorage.removeItem("engineStrength"),console.warn("Carry over old settings"))},updateFilter:function(e){var t=e.target.value;r.ga.event("opening style",t),this.model.set({preferred_style:t})},initialize:function(e){var t=this;this.model=e.model,this.getOldSettings(this.model),this.render(),this.baseRender(),this.$filter=$("#opening-filter"),this.$filter.val(this.model.preferred_style),$('#settings-sf input[type="number"]').on("change",this.update.bind(this)),this.$sp=$("#strength-profile"),this.$sp.val(this.model.strength_profile),this.$sp.on("change",this.updateStrength.bind(this)),this.$player_el.on("change",(function(e){var n=e.target.value;n=e.target.checked,t.model.player_color=n?"w":"b"})),this.$filter.on("change",this.updateFilter.bind(this)),this.listenTo(this.model,"change",this.render),$(".settings-tab").click((function(e){$(".settings-tab, .g-items").removeClass("active"),$(this).addClass("active");var t=$(this).data("sel");$("#".concat(t)).addClass("active")})),$('[name="pieces"').change((function(t){var n=$(this).val();e.model.pieces=n;var o=r.boardFn.getTheme(n);r.ga.event("pieces",n),r.boardFn.init([{name:"board",config:{pieceTheme:o}}],r),$(".board-wrapper").removeClass("pieces_default pieces_classic pieces_book"),$(".board-wrapper").addClass("pieces_".concat(n))})),$("#theme_select").change((function(t){var n=$(this).val();e.model.board_color=n,r.ga.event("board_color",n),$("#board").removeClass("theme-green theme-pc-black theme-pc-wood theme-pc-marker theme-pc-worn theme-pc-modern").addClass("theme-".concat(n))}));var n=this.model.board_color;"default"!==n&&($("#theme_select").val(n),$("#board").addClass("theme-".concat(n))),a(e.model),$("#export_pgn").click((function(e){e.preventDefault(),e.stopPropagation();var t=r.chess.pgn();if(""!==t){var n=["1-0","0-1","1/2-1/2"],o=r.settings.player_color,i=r.settings.player_name,s=r.GAME.opponent_name,a=(new Date).toString(),l="w"===o?i:s,u="b"===o?i:s,f=!r.GAME.in_progress,d=r.GAME.result,p="",h=r.settings.strength;r.chess.header("Event","Online Game - ChessUI.com","Date",a,"White",l,"Black",u,"Engine Strength",h),f&&(1===d?p=n[2]:(p="w"===o&&2===d||"b"===o&&0===d?n[0]:n[1],r.chess.header("Result",p))),r.ga.event("Exported Game","Strength: ".concat(h," Result: ").concat(p)),c("game.pgn",t)}}))},baseRender:function(){this.$el.html(this.template(this.model)),$("#show_legal, #cloud_engine").on("change",this.update.bind(this)),$("#show_legal").prop("checked",this.model.show_legal),$("#cloud_engine").prop("checked",this.model.cloud_engine);var e=this.model.pieces;$(".board-wrapper").addClass("pieces_".concat(e)),$("#pieces_".concat(e)).prop("checked",!0)},render:function(){return this.$player_el.html(this.player_template(this.model)),this}})},function(e,t,n){var r=n(15),o=n(110),i=n(111),s=n(249),a=n(259),c=n(117),l=n(46),u=n(275),f=["collection","el","viewOptions","view","emptyView","filter","reverse","parent"];function d(e){if(!e)throw new ReferenceError("Collection view missing required parameters: collection, el");if(!e.collection)throw new ReferenceError("Collection view requires a collection");if(!e.el&&!this.insertSelf)throw new ReferenceError("Collection view requires an el");r(this,i(e,f)),this.views=[],this.listenTo(this.collection,"add",this._addViewForModel),this.listenTo(this.collection,"remove",this._removeViewForModel),this.listenTo(this.collection,"sort",this._rerenderAll),this.listenTo(this.collection,"refresh reset",this._reset)}r(d.prototype,l,{render:function(){return this._renderAll(),this},remove:function(){o(this.views,"remove"),this.stopListening()},_getViewByModel:function(e){return s(this.views,(function(t){return e===t.model}))},_createViewForModel:function(e,t){var n={model:e,collection:this.collection,parent:this},o=new this.view(r(n,this.viewOptions));return this.views.push(o),o.renderedByParentView=!0,o.render(t),o},_getOrCreateByModel:function(e,t){return this._getViewByModel(e)||this._createViewForModel(e,t)},_addViewForModel:function(e,t,n){if(!this.filter||this.filter(e)){this.renderedEmptyView&&(this._removeView(this.renderedEmptyView),delete this.renderedEmptyView);var r=this._getOrCreateByModel(e,{containerEl:this.el});n&&n.rerender?this._insertView(r):this._insertViewAtIndex(r)}},_insertViewAtIndex:function(e){if(!e.insertSelf){var t=this.collection.indexOf(e.model);t=this.reverse?t-1:t+1;var n=this.collection.at(t),r=this._getViewByModel(n);r?this.el.insertBefore(e.el,r&&r.el):this.el.appendChild(e.el)}},_insertView:function(e){e.insertSelf||(this.reverse&&this.el.firstChild?this.el.insertBefore(e.el,this.el.firstChild):this.el.appendChild(e.el))},_removeViewForModel:function(e){var t=this._getViewByModel(e);if(t){var n=this.views.indexOf(t);-1!==n&&(t=this.views.splice(n,1)[0],this._removeView(t),this._renderEmptyView())}},_removeView:function(e){e.animateRemove?e.animateRemove():e.remove()},_renderAll:function(){this.collection.each(c(this._addViewForModel,this)),this._renderEmptyView()},_rerenderAll:function(e,t){t=t||{},this.collection.each(c((function(e){this._addViewForModel(e,this,r(t,{rerender:!0}))}),this))},_renderEmptyView:function(){0===this.views.length&&this.emptyView&&!this.renderedEmptyView&&(this.renderedEmptyView=new this.emptyView({parent:this}),this.el.appendChild(this.renderedEmptyView.render().el))},_reset:function(){var e=this.collection.map(c(this._getOrCreateByModel,this));a(this.views,e).forEach(this._removeView,this),this.views=e,this._rerenderAll(),this._renderEmptyView()}}),d.extend=u,e.exports=d},function(e,t,n){var r=n(22),o=n(8),i=n(62),s=n(98),a=n(9);e.exports=function(e,t,n){t=o(t,e);var c=null==(e=s(e,t))?e:e[a(i(t))];return null==c?void 0:r(c,e,n)}},function(e,t,n){var r=n(246),o=n(112);e.exports=function(e,t){return r(e,t,(function(t,n){return o(e,n)}))}},function(e,t,n){var r=n(42),o=n(247),i=n(8);e.exports=function(e,t,n){for(var s=-1,a=t.length,c={};++s<a;){var l=t[s],u=r(e,l);n(u,l)&&o(c,i(l,e),u)}return c}},function(e,t,n){var r=n(31),o=n(8),i=n(18),s=n(3),a=n(9);e.exports=function(e,t,n,c){if(!s(e))return e;for(var l=-1,u=(t=o(t,e)).length,f=u-1,d=e;null!=d&&++l<u;){var p=a(t[l]),h=n;if(l!=f){var v=d[p];void 0===(h=c?c(v,p,d):void 0)&&(h=s(v)?v:i(t[l+1])?[]:{})}r(d,p,h),d=d[p]}return e}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){var r=n(250)(n(258));e.exports=r},function(e,t,n){var r=n(113),o=n(4),i=n(5);e.exports=function(e){return function(t,n,s){var a=Object(t);if(!o(t)){var c=r(n,3);t=i(t),n=function(e){return c(a[e],e,a)}}var l=e(t,n,s);return l>-1?a[c?t[l]:l]:void 0}}},function(e,t,n){var r=n(252),o=n(253),i=n(115);e.exports=function(e){var t=o(e);return 1==t.length&&t[0][2]?i(t[0][0],t[0][1]):function(n){return n===e||r(n,e,t)}}},function(e,t,n){var r=n(55),o=n(64),i=1,s=2;e.exports=function(e,t,n,a){var c=n.length,l=c,u=!a;if(null==e)return!l;for(e=Object(e);c--;){var f=n[c];if(u&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++c<l;){var d=(f=n[c])[0],p=e[d],h=f[1];if(u&&f[2]){if(void 0===p&&!(d in e))return!1}else{var v=new r;if(a)var m=a(p,h,d,e,t,v);if(!(void 0===m?o(h,p,i|s,a,v):m))return!1}}return!0}},function(e,t,n){var r=n(114),o=n(5);e.exports=function(e){for(var t=o(e),n=t.length;n--;){var i=t[n],s=e[i];t[n]=[i,s,r(s)]}return t}},function(e,t,n){var r=n(64),o=n(116),i=n(112),s=n(61),a=n(114),c=n(115),l=n(9),u=1,f=2;e.exports=function(e,t){return s(e)&&a(t)?c(l(e),t):function(n){var s=o(n,e);return void 0===s&&s===t?i(n,e):r(t,s,u|f)}}},function(e,t,n){var r=n(256),o=n(257),i=n(61),s=n(9);e.exports=function(e){return i(e)?r(s(e)):o(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,n){var r=n(42);e.exports=function(e){return function(t){return r(t,e)}}},function(e,t,n){var r=n(102),o=n(113),i=n(24),s=Math.max;e.exports=function(e,t,n){var a=null==e?0:e.length;if(!a)return-1;var c=null==n?0:i(n);return c<0&&(c=s(a+c,0)),r(e,o(t,3),c)}},function(e,t,n){var r=n(260),o=n(63),i=n(17),s=n(108),a=i((function(e,t){return s(e)?r(e,o(t,1,s,!0)):[]}));e.exports=a},function(e,t,n){var r=n(65),o=n(67),i=n(106),s=n(33),a=n(19),c=n(66),l=200;e.exports=function(e,t,n,u){var f=-1,d=o,p=!0,h=e.length,v=[],m=t.length;if(!h)return v;n&&(t=s(t,a(n))),u?(d=i,p=!1):t.length>=l&&(d=c,p=!1,t=new r(t));e:for(;++f<h;){var g=e[f],_=null==n?g:n(g);if(g=u||0!==g?g:0,p&&_==_){for(var b=m;b--;)if(t[b]===_)continue e;v.push(g)}else d(t,_,u)||v.push(g)}return v}},function(e,t,n){var r=n(43),o=n(0),i=1;e.exports=function(e,t,n){var s=t&i,a=r(e);return function t(){return(this&&this!==o&&this instanceof t?a:e).apply(s?n:this,arguments)}}},function(e,t,n){var r=n(22),o=n(43),i=n(121),s=n(124),a=n(44),c=n(23),l=n(0);e.exports=function(e,t,n){var u=o(e);return function o(){for(var f=arguments.length,d=Array(f),p=f,h=a(o);p--;)d[p]=arguments[p];var v=f<3&&d[0]!==h&&d[f-1]!==h?[]:c(d,h);return(f-=v.length)<n?s(e,t,i,o.placeholder,void 0,d,v,void 0,void 0,n-f):r(this&&this!==l&&this instanceof o?u:e,this,d)}}},function(e,t){e.exports=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}},function(e,t,n){var r=n(69),o=n(125),i=n(265),s=n(267);e.exports=function(e){var t=i(e),n=s[t];if("function"!=typeof n||!(t in r.prototype))return!1;if(e===n)return!0;var a=o(n);return!!a&&e===a[0]}},function(e,t,n){var r=n(266),o=Object.prototype.hasOwnProperty;e.exports=function(e){for(var t=e.name+"",n=r[t],i=o.call(r,t)?n.length:0;i--;){var s=n[i],a=s.func;if(null==a||a==e)return s.name}return t}},function(e,t){e.exports={}},function(e,t,n){var r=n(69),o=n(126),i=n(70),s=n(1),a=n(2),c=n(268),l=Object.prototype.hasOwnProperty;function u(e){if(a(e)&&!s(e)&&!(e instanceof r)){if(e instanceof o)return e;if(l.call(e,"__wrapped__"))return c(e)}return new o(e)}u.prototype=i.prototype,u.prototype.constructor=u,e.exports=u},function(e,t,n){var r=n(69),o=n(126),i=n(34);e.exports=function(e){if(e instanceof r)return e.clone();var t=new o(e.__wrapped__,e.__chain__);return t.__actions__=i(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}},function(e,t){var n=/\{\n\/\* \[wrapped with (.+)\] \*/,r=/,? & /;e.exports=function(e){var t=e.match(n);return t?t[1].split(r):[]}},function(e,t){var n=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;e.exports=function(e,t){var r=t.length;if(!r)return e;var o=r-1;return t[o]=(r>1?"& ":"")+t[o],t=t.join(r>2?", ":" "),e.replace(n,"{\n/* [wrapped with "+t+"] */\n")}},function(e,t,n){var r=n(52),o=n(67),i=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];e.exports=function(e,t){return r(i,(function(n){var r="_."+n[0];t&n[1]&&!o(e,r)&&e.push(r)})),e.sort()}},function(e,t,n){var r=n(34),o=n(18),i=Math.min;e.exports=function(e,t){for(var n=e.length,s=i(t.length,n),a=r(e);s--;){var c=t[s];e[s]=o(c,n)?a[c]:void 0}return e}},function(e,t,n){var r=n(22),o=n(43),i=n(0),s=1;e.exports=function(e,t,n,a){var c=t&s,l=o(e);return function t(){for(var o=-1,s=arguments.length,u=-1,f=a.length,d=Array(f+s),p=this&&this!==i&&this instanceof t?l:e;++u<f;)d[u]=a[u];for(;s--;)d[u++]=arguments[++o];return r(p,c?n:this,d)}}},function(e,t,n){var r=n(122),o=n(123),i=n(23),s="__lodash_placeholder__",a=1,c=2,l=4,u=8,f=128,d=256,p=Math.min;e.exports=function(e,t){var n=e[1],h=t[1],v=n|h,m=v<(a|c|f),g=h==f&&n==u||h==f&&n==d&&e[7].length<=t[8]||h==(f|d)&&t[7].length<=t[8]&&n==u;if(!m&&!g)return e;h&a&&(e[2]=t[2],v|=n&a?0:l);var _=t[3];if(_){var b=e[3];e[3]=b?r(b,_,t[4]):_,e[4]=b?i(e[3],s):t[4]}return(_=t[5])&&(b=e[5],e[5]=b?o(b,_,t[6]):_,e[6]=b?i(e[5],s):t[6]),(_=t[7])&&(e[7]=_),h&f&&(e[8]=null==e[8]?t[8]:p(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=v,e}},function(e,t,n){var r=n(15);e.exports=function(e){var t,n=this,o=[].slice.call(arguments);t=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return n.apply(this,arguments)},r(t,n);var i=function(){this.constructor=t};return i.prototype=n.prototype,t.prototype=new i,e&&(o.unshift(t.prototype),r.apply(null,o)),t.__super__=n.prototype,t}},function(e,t){e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("String expected");t||(t=document);var n=/<([\w:]+)/.exec(e);if(!n)return t.createTextNode(e);e=e.replace(/^\s+|\s+$/g,"");var r=n[1];if("body"==r){return(i=t.createElement("html")).innerHTML=e,i.removeChild(i.lastChild)}var i,s=o[r]||o._default,a=s[0],c=s[1],l=s[2];(i=t.createElement("div")).innerHTML=c+e+l;for(;a--;)i=i.lastChild;if(i.firstChild==i.lastChild)return i.removeChild(i.firstChild);var u=t.createDocumentFragment();for(;i.firstChild;)u.appendChild(i.removeChild(i.firstChild));return u};var n,r=!1;"undefined"!=typeof document&&((n=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',r=!n.getElementsByTagName("link").length,n=void 0);var o={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:r?[1,"X<div>","</div>"]:[0,"",""]};o.td=o.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],o.option=o.optgroup=[1,'<select multiple="multiple">',"</select>"],o.thead=o.tbody=o.colgroup=o.caption=o.tfoot=[1,"<table>","</table>"],o.polyline=o.ellipse=o.polygon=o.circle=o.text=o.line=o.path=o.rect=o.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},function(e,t,n){var r=n(129),o=n(278),i=["focus","blur"];function s(e,t){if(!(this instanceof s))return new s(e,t);if(!e)throw new Error("element required");if(!t)throw new Error("object required");this.el=e,this.obj=t,this._events={}}function a(e){var t=e.split(/ +/);return{name:t.shift(),selector:t.join(" ")}}e.exports=s,s.prototype.sub=function(e,t,n){this._events[e]=this._events[e]||{},this._events[e][t]=n},s.prototype.bind=function(e,t){var n=function(e,t){var n=a(e),i=this.el,s=this.obj,c=n.name,l=(t=t||"on"+c,[].slice.call(arguments,2));function u(){var e=[].slice.call(arguments).concat(l);if("function"!=typeof t){if(!s[t])throw new Error(t+" method is not defined");s[t].apply(s,e)}else t.apply(s,e)}return n.selector?u=o.bind(i,n.selector,c,u):r.bind(i,c,u),this.sub(c,t,u),u};if("string"==typeof e)n.apply(this,arguments);else for(var i in e)e.hasOwnProperty(i)&&n.call(this,i,e[i])},s.prototype.unbind=function(e,t){if(0==arguments.length)return this.unbindAll();if(1==arguments.length)return this.unbindAllOf(e);var n=this._events[e],o=-1!==i.indexOf(e);if(n){var s=n[t];s&&r.unbind(this.el,e,s,o)}},s.prototype.unbindAll=function(){for(var e in this._events)this.unbindAllOf(e)},s.prototype.unbindAllOf=function(e){var t=this._events[e];if(t)for(var n in t)this.unbind(e,n)}},function(e,t,n){var r=n(279),o=n(129),i=["focus","blur"];t.bind=function(e,t,n,s,a){return-1!==i.indexOf(n)&&(a=!0),o.bind(e,n,(function(n){var o=n.target||n.srcElement;n.delegateTarget=r(o,t,!0,e),n.delegateTarget&&s.call(e,n)}),a)},t.unbind=function(e,t,n,r){-1!==i.indexOf(t)&&(r=!0),o.unbind(e,t,n,r)}},function(e,t,n){var r=n(280);e.exports=function(e,t,n){for(var o=n?e:e.parentNode;o&&o!==document;){if(r(o,t))return o;o=o.parentNode}}},function(e,t){var n=Element.prototype,r=n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;e.exports=function(e,t){if(r)return r.call(e,t);for(var n=e.parentNode.querySelectorAll(t),o=0;o<n.length;++o)if(n[o]==e)return!0;return!1}},function(e,t,n){var r=n(109),o=n(282),i=n(130),s=n(283),a=Array.prototype.slice;function c(e,t,n){if(""===t)return[e];var r=[];return t?n?i(e,t)?[e]:e.querySelector(t)?[e.querySelector(t)]:[]:(i(e,t)&&r.push(e),r.concat(a.call(e.querySelectorAll(t)))):r}function l(e){return Array.isArray(e)?e:[e]}function u(e,t,n){var r=e.cases[n],i=e.firstMatchOnly;for(var s in e.cases){var a=e.cases[s];n!==s&&a!==r&&c(t,a,i).forEach((function(e){o.hide(e)}))}c(t,r,i).forEach((function(e){o.show(e)}))}function f(e,t){var n,r=e.type||"text",i="function"==typeof r,a=function(e){return"string"==typeof e.selector?e.selector:e.hook?'[data-hook~="'+e.hook+'"]':""}(e),f=e.firstMatchOnly,d=e.yes,p=e.no,h=!(!d&&!p);if(i)return function(e,o){c(e,a,f).forEach((function(e){r.call(t,e,o,n)})),n=o};if("text"===r)return function(e,t){c(e,a,f).forEach((function(e){o.text(e,t)}))};if("class"===r)return function(e,t){c(e,a,f).forEach((function(e){o.switchClass(e,n,t)})),n=t};if("attribute"===r){if(!e.name)throw Error('attribute bindings must have a "name"');return function(t,r){var i=l(e.name);c(t,a,f).forEach((function(e){i.forEach((function(t){o.setAttribute(e,t,r)}))})),n=r}}if("value"===r)return function(e,t){c(e,a,f).forEach((function(e){t||0===t||(t=""),document.activeElement!==e&&(e.value=t)})),n=t};if("booleanClass"===r)return h?(d=l(d||""),p=l(p||""),function(e,t){var n=t?p:d,r=t?d:p;c(e,a,f).forEach((function(e){n.forEach((function(t){o.removeClass(e,t)})),r.forEach((function(t){o.addClass(e,t)}))}))}):function(t,n,r){var i=l(e.name||r),s=e.invert||!1;n=s?!n:n,c(t,a,f).forEach((function(e){i.forEach((function(t){o[n?"addClass":"removeClass"](e,t)}))}))};if("booleanAttribute"===r)return h?(d=l(d||""),p=l(p||""),function(e,t){var n=t?p:d,r=t?d:p;c(e,a,f).forEach((function(e){n.forEach((function(t){t&&o.removeAttribute(e,t)})),r.forEach((function(t){t&&o.addAttribute(e,t)}))}))}):function(t,n,r){var i=l(e.name||r),s=e.invert||!1;n=s?!n:n,c(t,a,f).forEach((function(e){i.forEach((function(t){o[n?"addAttribute":"removeAttribute"](e,t)}))}))};if("toggle"===r){var v=e.mode||"display",m=e.invert||!1;return h?function(e,t){c(e,d,f).forEach((function(e){o[t?"show":"hide"](e,v)})),c(e,p,f).forEach((function(e){o[t?"hide":"show"](e,v)}))}:function(e,t){t=m?!t:t,c(e,a,f).forEach((function(e){o[t?"show":"hide"](e,v)}))}}if("switch"===r){if(!e.cases)throw Error('switch bindings must have "cases"');return s(u,e)}if("innerHTML"===r)return function(e,t){c(e,a,f).forEach((function(e){o.html(e,t)}))};if("switchClass"===r){if(!e.cases)throw Error('switchClass bindings must have "cases"');return function(t,n,r){var i=l(e.name||r);for(var s in e.cases)c(t,e.cases[s],f).forEach((function(e){i.forEach((function(t){o[n===s?"addClass":"removeClass"](e,t)}))}))}}if("switchAttribute"===r){if(!e.cases)throw Error('switchAttribute bindings must have "cases"');return function(t,r,i){c(t,a,f).forEach((function(t){if(n&&function(e,t){for(var n in t)o.removeAttribute(e,n)}(t,n),r in e.cases){var s=e.cases[r];"string"==typeof s&&((s={})[e.name||i]=e.cases[r]),function(e,t){for(var n in t)o.setAttribute(e,n,t[n])}(t,s),n=s}}))}}throw new Error("no such binding type: "+r)}e.exports=function(e,t){var n,o,i=new r;for(n in e)"string"==typeof(o=e[n])?i.add(n,f({type:"text",selector:o})):o.forEach?o.forEach((function(e){i.add(n,f(e,t))})):i.add(n,f(o,t));return i}},function(e,t){var n=e.exports={text:function(e,t){e.textContent=r(t)},addClass:function(e,t){(t=r(t))&&(Array.isArray(t)?t.forEach((function(t){n.addClass(e,t)})):e.classList?e.classList.add(t):o(e,t)||(e.classList?e.classList.add(t):e.className+=" "+t))},removeClass:function(e,t){Array.isArray(t)?t.forEach((function(t){n.removeClass(e,t)})):e.classList?(t=r(t))&&e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},hasClass:o,switchClass:function(e,t,n){t&&this.removeClass(e,t),this.addClass(e,n)},addAttribute:function(e,t){e.setAttribute(t,""),i(e,t)&&(e[t]=!0)},removeAttribute:function(e,t){e.removeAttribute(t),i(e,t)&&(e[t]=!1)},setAttribute:function(e,t,n){e.setAttribute(t,r(n))},getAttribute:function(e,t){return e.getAttribute(t)},hasAttribute:function(e,t){return e.hasAttribute(t)},hide:function(e,t){t||(t="display"),s(e)||(function(e,t){n.setAttribute(e,"data-anddom-"+t,e.style[t])}(e,t),function(e,t){n.setAttribute(e,"data-anddom-hidden","true"),e.style[t]="visibility"===t?"hidden":"none"}(e,t))},show:function(e,t){t||(t="display"),function(e,t){e.style[t]=n.getAttribute(e,"data-anddom-"+t)||"",n.removeAttribute(e,"data-anddom-hidden")}(e,t)},toggle:function(e,t){s(e)?n.show(e,t):n.hide(e,t)},html:function(e,t){e.innerHTML=t}};function r(e){return e||0===e?e:""}function o(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function i(e,t){var n=e[t];return t in e&&(!0===n||!1===n)}function s(e){return"true"===n.getAttribute(e,"data-anddom-hidden")}},function(e,t,n){var r=n(17),o=n(118),i=n(44),s=n(23),a=r((function(e,t){var n=s(t,i(a));return o(e,32,void 0,t,n)}));a.placeholder={},e.exports=a},function(e,t,n){"use strict";e.exports=n(285)},function(e,t,n){var r=n(45);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,o){return'\r\n\r\n  <div class="settings-tabs">\r\n    <div class="settings-tab active" data-sel="settings-sf">Difficulty</div>\r\n    <div class="settings-tab" data-sel="settings-train">Training</div>\r\n    <div class="settings-tab" data-sel="settings-op">Openings</div>\r\n    <div class="settings-tab" data-sel="settings-board">Board</div>\r\n    <div class="settings-tab" data-sel="settings-pieces">Pieces</div>\r\n    <div class="settings-tab" data-sel="settings-cloud">Cloud Info</div>\r\n  </div>\r\n  <div class="settings-container">\r\n    <div class="g-items active" id="settings-sf">\r\n      \r\n      <div class="settings-item">\r\n      <small>Strength<br/>Profile</small>\r\n      <select id="strength-profile" width="50%" style="max-width: 50%;">\r\n        <option value="1400">Casual up to ~ 1600</option>\r\n        <option default value="1600">Advanced ~ 1800</option>\r\n        <option value="1850">Strong ~ 2000 </option>\r\n        <option value="2100">Master ~ 2300</option>\r\n        <option value="2400">IM-GM - Strongest engine oponents</option>\r\n      </select></div>\r\n      <div></div>\r\n      <div class="settings-item" >\r\n        <span><input type="checkbox" name="cloud_engine" id="cloud_engine" ><label alt="Lc0 and Fruit" for="cloud_engine"><small>Enable cloud engines</small></label></span>\r\n        \r\n      </div>\r\n    </div>\r\n    <div class="g-items" id="settings-cloud">\r\n      <div><small>When enabled, an engine running on the cloud will play against you to add variety to the game play.  There are three engines: <a href="https://blog.stockfishchess.org/post/628172810852925440/stockfish-12">Stock Fish 12/15 (NNUE)</a>, <a href="http://lczero.org/">Lc0 v.28</a> and <a href="http://www.fruitchess.com/">Fruit</a>.  Opening book is still used even for cloud engines and Stockfish 10 may tag in during the middle game if the cloud engine takes too long to evaluate.  Cloud engines will play according to the selected strength profile when possible.  Fruit is only available for the strongest settings.</small></div>\r\n    </div>\r\n    <div class="g-items" id="settings-train">\r\n      <div class="game-actions hide-sm">\r\n          <input type="button" id="load-fen" class="game-btn btn-base" value="Set FEN" /> <input type="button" id="load-odds" class="game-btn btn-base" value="Player Odds" /> <input type="button" id="load-training" class="game-btn btn-base"\r\n              value="Training" />\r\n      </div>\r\n    </div>\r\n    <div class="g-items" id="settings-op">\r\n      <div class="settings-item g-flex">\r\n      <label>Preferred Opening/Style</label>\r\n      <select id="opening-filter">\r\n              <option value="default" selected>Any</option>\r\n              <option value="defence">Defence</option>\r\n              <option value="attack">Attack</option>\r\n              <option value="trap">Trap</option>\r\n              <option value="gambit">Gambit</option>\r\n              <option value="counter">Counter</option>\r\n              <option value="sicilian">Sicilian</option>\r\n              <option value="english">English</option>\r\n              <option value="french">French</option>\r\n              <option value="queen">Queen\'s openings</option>\r\n              <option value="king">Kings\'s openings</option>\r\n              <option value="indian">Indian openings</option>\r\n              <option value="Ruy Lopez">Ruy Lopez</option>\r\n              </select>\r\n      </div>\r\n      <div id="specific-opening" class="hide"><input type="text" placeholder="Opening name or ECO" /></div>\r\n    </div>\r\n    <div class="g-items" id="settings-board">\r\n      <div class="settings-item g-flex">\r\n          <span><input type="checkbox" name="show_legal" id="show_legal"  ><label for="show_legal">Show legal moves</label></span>\r\n      </div>\r\n      <div class="settings-item g-flex">\r\n          <span>Theme: </span>\r\n                    <span>\r\n                      <select name="theme" id="theme_select">\r\n                        <option value="default">Default</option>\r\n                        <option value="green">Green</option>\r\n                        <option value="pc-black">Black</option>\r\n                        <option value="pc-wood">Wood</option>\r\n                        <option value="pc-marker">Marker</option>\r\n                        <option value="pc-modern">Modern</option>\r\n                        <option value="pc-worn">Worn</option>\r\n                      </select>\r\n          </span>\r\n      </div>\r\n    </div>\r\n        <div class="g-items" id="settings-pieces">\r\n      <div class="settings-item g-flex">\r\n          <span>\r\n            <input type="radio" name="pieces" id="pieces_default"  value="default" ><label for="piece_default">Default</label>\r\n            <input type="radio" name="pieces" id="pieces_classic"  value="classic"><label for="piece_classic">Classic</label>\r\n            <input type="radio" name="pieces" id="pieces_book"  value="book"><label for="piece_book">Book</label>\r\n          </span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n'},useData:!0})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=o(n(131)),s=r(n(297)),a=r(n(13)),c=o(n(6)),l=o(n(298)),u=r(n(299));function f(){var e=new i.HandlebarsEnvironment;return c.extend(e,i),e.SafeString=s.default,e.Exception=a.default,e.Utils=c,e.escapeExpression=c.escapeExpression,e.VM=l,e.template=function(t){return l.template(t,e)},e}var d=f();d.create=f,u.default(d),d.default=d,t.default=d,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=n(6);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,n){var o=n.inverse,i=n.fn;if(!0===t)return i(this);if(!1===t||null==t)return o(this);if(r.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):o(this);if(n.data&&n.ids){var s=r.createFrame(n.data);s.contextPath=r.appendContextPath(n.data.contextPath,n.name),n={data:s}}return i(t,n)}))},e.exports=t.default},function(e,t,n){"use strict";(function(r){t.__esModule=!0;var o,i=n(6),s=n(13),a=(o=s)&&o.__esModule?o:{default:o};t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new a.default("Must pass iterator to #each");var n,o=t.fn,s=t.inverse,c=0,l="",u=void 0,f=void 0;function d(t,n,r){u&&(u.key=t,u.index=n,u.first=0===n,u.last=!!r,f&&(u.contextPath=f+t)),l+=o(e[t],{data:u,blockParams:i.blockParams([e[t],t],[f+t,null])})}if(t.data&&t.ids&&(f=i.appendContextPath(t.data.contextPath,t.ids[0])+"."),i.isFunction(e)&&(e=e.call(this)),t.data&&(u=i.createFrame(t.data)),e&&"object"==typeof e)if(i.isArray(e))for(var p=e.length;c<p;c++)c in e&&d(c,c,c===e.length-1);else if(r.Symbol&&e[r.Symbol.iterator]){for(var h=[],v=e[r.Symbol.iterator](),m=v.next();!m.done;m=v.next())h.push(m.value);for(p=(e=h).length;c<p;c++)d(c,c,c===e.length-1)}else n=void 0,Object.keys(e).forEach((function(e){void 0!==n&&d(n,c-1),n=e,c++})),void 0!==n&&d(n,c-1,!0);return 0===c&&(l=s(this)),l}))},e.exports=t.default}).call(this,n(26))},function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(13),i=(r=o)&&r.__esModule?r:{default:r};t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(6),i=n(13),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new s.default("#if requires exactly one argument");return o.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||o.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,n){if(2!=arguments.length)throw new s.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}))},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],n=arguments[arguments.length-1],r=0;r<arguments.length-1;r++)t.push(arguments[r]);var o=1;null!=n.hash.level?o=n.hash.level:n.data&&null!=n.data.level&&(o=n.data.level),t[0]=o,e.log.apply(e,t)}))},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=/^(constructor|__defineGetter__|__defineSetter__|__lookupGetter__|__proto__)$/;t.dangerousPropertyRegex=r,t.default=function(e){e.registerHelper("lookup",(function(e,t){return e?!r.test(String(t))||Object.prototype.propertyIsEnumerable.call(e,t)?e[t]:void 0:e}))}},function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(6),i=n(13),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new s.default("#with requires exactly one argument");o.isFunction(e)&&(e=e.call(this));var n=t.fn;if(o.isEmpty(e))return t.inverse(this);var r=t.data;return t.data&&t.ids&&((r=o.createFrame(t.data)).contextPath=o.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:r,blockParams:o.blockParams([e],[r&&r.contextPath])})}))},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0,t.registerDefaultDecorators=function(e){i.default(e)};var r,o=n(295),i=(r=o)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(6);t.default=function(e){e.registerDecorator("inline",(function(e,t,n,o){var i=e;return t.partials||(t.partials={},i=function(o,i){var s=n.partials;n.partials=r.extend({},s,t.partials);var a=e(o,i);return n.partials=s,a}),t.partials[o.args[0]]=o.fn,i}))},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=n(6),o={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=r.indexOf(o.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=o.lookupLevel(e),"undefined"!=typeof console&&o.lookupLevel(o.level)<=e){var t=o.methodMap[e];console[t]||(t="log");for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];console[t].apply(console,r)}}};t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){this.string=e}t.__esModule=!0,r.prototype.toString=r.prototype.toHTML=function(){return""+this.string},t.default=r,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=a.COMPILER_REVISION;if(t>=a.LAST_COMPATIBLE_COMPILER_REVISION&&t<=a.COMPILER_REVISION)return;if(t<a.LAST_COMPATIBLE_COMPILER_REVISION){var r=a.REVISION_CHANGES[n],o=a.REVISION_CHANGES[t];throw new s.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+o+").")}throw new s.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")},t.template=function(e,t){if(!t)throw new s.default("No environment passed to template");if(!e||!e.main)throw new s.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var n=e.compiler&&7===e.compiler[0];var r={strict:function(e,t,n){if(!(e&&t in e))throw new s.default('"'+t+'" not defined in '+e,{loc:n});return e[t]},lookup:function(e,t){for(var n=e.length,r=0;r<n;r++)if(e[r]&&null!=e[r][t])return e[r][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:o.escapeExpression,invokePartial:function(n,r,i){i.hash&&(r=o.extend({},r,i.hash),i.ids&&(i.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,r,i);var a=o.extend({},i,{hooks:this.hooks}),c=t.VM.invokePartial.call(this,n,r,a);if(null==c&&t.compile&&(i.partials[i.name]=t.compile(n,e.compilerOptions,t),c=i.partials[i.name](r,a)),null!=c){if(i.indent){for(var l=c.split("\n"),u=0,f=l.length;u<f&&(l[u]||u+1!==f);u++)l[u]=i.indent+l[u];c=l.join("\n")}return c}throw new s.default("The partial "+i.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,r,o){var i=this.programs[e],s=this.fn(e);return t||o||r||n?i=l(this,e,s,t,n,r,o):i||(i=this.programs[e]=l(this,e,s)),i},data:function(e,t){for(;e&&t--;)e=e._parent;return e},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};function i(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=n.data;i._setup(n),!n.partial&&e.useData&&(o=function(e,t){t&&"root"in t||((t=t?a.createFrame(t):{}).root=e);return t}(t,o));var s=void 0,c=e.useBlockParams?[]:void 0;function l(t){return""+e.main(r,t,r.helpers,r.partials,o,c,s)}return e.useDepths&&(s=n.depths?t!=n.depths[0]?[t].concat(n.depths):n.depths:[t]),(l=f(e.main,l,r,n.depths||[],o,c))(t,n)}return i.isTop=!0,i._setup=function(i){if(i.partial)r.helpers=i.helpers,r.partials=i.partials,r.decorators=i.decorators,r.hooks=i.hooks;else{r.helpers=o.extend({},t.helpers,i.helpers),e.usePartial&&(r.partials=o.extend({},t.partials,i.partials)),(e.usePartial||e.useDecorators)&&(r.decorators=o.extend({},t.decorators,i.decorators)),r.hooks={};var s=i.allowCallsToHelperMissing||n;c.moveHelperToHooks(r,"helperMissing",s),c.moveHelperToHooks(r,"blockHelperMissing",s)}},i._child=function(t,n,o,i){if(e.useBlockParams&&!o)throw new s.default("must pass block params");if(e.useDepths&&!i)throw new s.default("must pass parent depths");return l(r,t,e[t],n,0,o,i)},i},t.wrapProgram=l,t.resolvePartial=function(e,t,n){e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name];return e},t.invokePartial=function(e,t,n){var r=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var i=void 0;n.fn&&n.fn!==u&&function(){n.data=a.createFrame(n.data);var e=n.fn;i=n.data["partial-block"]=function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.data=a.createFrame(n.data),n.data["partial-block"]=r,e(t,n)},e.partials&&(n.partials=o.extend({},n.partials,e.partials))}();void 0===e&&i&&(e=i);if(void 0===e)throw new s.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=u;var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(6)),i=n(13),s=(r=i)&&r.__esModule?r:{default:r},a=n(131),c=n(132);function l(e,t,n,r,o,i,s){function a(t){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=s;return!s||t==s[0]||t===e.nullContext&&null===s[0]||(a=[t].concat(s)),n(e,t,e.helpers,e.partials,o.data||r,i&&[o.blockParams].concat(i),a)}return(a=f(n,a,e,s,r,i)).program=t,a.depth=s?s.length:0,a.blockParams=o||0,a}function u(){return""}function f(e,t,n,r,i,s){if(e.decorator){var a={};t=e.decorator(t,a,n,r&&r[0],i,s,r),o.extend(t,a)}return t}},function(e,t,n){"use strict";(function(n){t.__esModule=!0,t.default=function(e){var t=void 0!==n?n:window,r=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=r),e}},e.exports=t.default}).call(this,n(26))},function(e,t,n){"use strict";e.exports=n(301)},function(e,t,n){var r=n(45);e.exports=(r.default||r).template({1:function(e,t,n,r,o){return"checked"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,o){var i;return'<label for="player_color">Play as White</label><input type="checkbox" name="player_color" '+(null!=(i=n.if.call(null!=t?t:e.nullContext||{},null!=t?t.play_as_white:t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:90},end:{line:1,column:125}}}))?i:"")+"/>"},useData:!0})},function(e,t){e.exports=function(e){$.fn.inlineEdit=function(t,n){$(this).hover((function(){$(this).addClass("hover")}),(function(){$(this).removeClass("hover")})),$(this).click((function(){var r=$(this);r.hide(),r.after(t),t.focus(),t.blur((function(){""!==$(this).val()&&(n.val($(this).val()).change(),r.text($(this).val()),e.set("player_name",$(this).val())),$(this).remove(),r.show()}))}))};var t=e.player_name,n=$("#bottom-player");n.text(t);var r=$('<input name="temp" type="text" />'),o=$('input[name="hiddenField"]');return n.inlineEdit(r,o),n}},function(e,t){e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"game.pgn",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain";if(navigator.msSaveBlob)navigator.msSaveBlob(new Blob([t],{type:n+";charset=utf-8;"}),e);else{var r=document.createElement("a");n=n||"text/plain",r.setAttribute("download",e),r.setAttribute("href","data:"+n+";charset=utf-8,"+encodeURIComponent(t)),document.body.appendChild(r),r.click(),document.body.removeChild(r)}}},function(e,t,n){"use strict";var r=n(68),o=n(305),i=n(71);e.exports=r.extend({template:o,$el:$("#movelist"),activeView:{},showMove:function(e){console.log(e)},initialize:function(e){var t=e.app;this.model=e.model;var n=this;this.render(),this.listenTo(this.model,"change",this.render),$(".hide-board").on("click",(function(e){e.preventDefault(),$("#review_board_container").removeClass("shown"),$("#move_label").html("")})),$("#review_moves").on("click",".review-move",(function(e){var t=$(this).data("action"),n=$("#review_moves").data("current"),r=$("#review_moves").data("color"),o=$("#movelist ol").children(),i=$(o.get(n)),s=o.get(n-1),a=o.get(n+1),c=o.last(),l=$(c);switch(t){case"first":$(o.get(0)).children().first().click();break;case"last":l.find(".b-move").data("move")?l.find(".b-move").click():l.find(".w-move").click();break;case"prev":if("b"===r)i.find(".w-move").click();else if(0!=n)if(s)$(s).find(".b-move").click();break;case"next":if("w"===r){var u=i.find(".b-move");u.data("move")&&u.click()}else{if(a)$(a).find(".w-move").click()}}})),this.$el.on("click",".move-item",(function(e){t.moves_list.render();var r=$(e.currentTarget),o=r.data("fen"),i=r.data("move"),s=r.data("score"),a=r.data("from"),c=r.data("to"),l=r.data("color"),u=r.data("ply"),f=r.data("index"),d=t.moves.ponder_list.filter((function(e){return e.index===u})),p="";n.activeView.index=f,n.activeView.color=l,n.activeView.ply=u,$("#review_moves").data("current",f),$("#review_moves").data("color",l),$("#board").find(".square-highlight-lite, .square-highlight-lite-border").removeClass("square-highlight-lite square-highlight-lite-border");var h=t.board.orientation(),v=$("#review_board");if(o&&t.review_board){if(t.ga.event("Move Review","Board open"),$("#review_board_container").addClass("shown"),$("#move_label").html("After... <b>".concat(i,"</b> ").concat(s?"Score: "+s:"")),d.length){var m=d[0].SAN[1];i!==m&&(p='Engine expected <span class="pd-move">'.concat(m,"</span>"))}$("#ponder_label").html(p),t.review_board.orientation(h),t.review_board.position(o,!1),$("#review_fen").val(o),a&&c&&(v.find(".square-".concat(a)).addClass("square-highlight-lite-border"),v.find(".square-".concat(c)).addClass("square-highlight-lite"))}})),$("#review_rewind_game").click((function(){var e=$("#review_fen").val(),r=$("#review_moves").data("color");n.activeView.rewind_turn="w"===r?"b":"w";var o=t.moves.move_list.length-n.activeView.ply;e&&(t.flow.rewindToMove(e,n.activeView),t.ga.event("Rewing Game","Moved back: "+o))}));var r=i((function(e){var t=$(e.target);if(t.hasClass("move-item")){var n=t.attr("data-from"),r=t.attr("data-to");$("#board").find(".square-"+r).addClass("square-highlight-lite"),$("#board").find(".square-"+n).addClass("square-highlight-lite-border")}}),16);this.$el.off("mouseover").on("mouseover",r).on("mouseout",(function(){$("#board").find(".square-highlight-lite, .square-highlight-lite-border").removeClass("square-highlight-lite square-highlight-lite-border")}))},render:function(){this.model.is_empty?this.$el.addClass("is-empty"):this.$el.removeClass("is-empty"),this.$el.html(this.template(this.model));this.$el;return this}})},function(e,t,n){"use strict";e.exports=n(306)},function(e,t,n){var r=n(45);e.exports=(r.default||r).template({1:function(e,t,n,r,o){var i,s,a=null!=t?t:e.nullContext||{},c=e.hooks.helperMissing,l="function",u=e.escapeExpression,f=e.lambda;return'    <li data-index="'+u(typeof(s=null!=(s=n.index||(null!=t?t.index:t))?s:c)===l?s.call(a,{name:"index",hash:{},data:o,loc:{start:{line:3,column:20},end:{line:3,column:29}}}):s)+'">\r\n      <span class="move-item w-move" data-fen="'+u(typeof(s=null!=(s=n.w_fen||(null!=t?t.w_fen:t))?s:c)===l?s.call(a,{name:"w_fen",hash:{},data:o,loc:{start:{line:4,column:47},end:{line:4,column:56}}}):s)+'" data-move="'+u(typeof(s=null!=(s=n.w||(null!=t?t.w:t))?s:c)===l?s.call(a,{name:"w",hash:{},data:o,loc:{start:{line:4,column:69},end:{line:4,column:74}}}):s)+'" data-color="w" data-ply="'+u(typeof(s=null!=(s=n.w_ply||(null!=t?t.w_ply:t))?s:c)===l?s.call(a,{name:"w_ply",hash:{},data:o,loc:{start:{line:4,column:101},end:{line:4,column:110}}}):s)+'" data-score="'+u(typeof(s=null!=(s=n.w_score||(null!=t?t.w_score:t))?s:c)===l?s.call(a,{name:"w_score",hash:{},data:o,loc:{start:{line:4,column:124},end:{line:4,column:135}}}):s)+'" data-from="'+u(f(null!=(i=null!=t?t.w_move_info:t)?i.from:i,t))+'" data-to="'+u(f(null!=(i=null!=t?t.w_move_info:t)?i.to:i,t))+'" data-captured="'+u(f(null!=(i=null!=t?t.w_move_info:t)?i.captured:i,t))+'" data-index="'+u(typeof(s=null!=(s=n.index||(null!=t?t.index:t))?s:c)===l?s.call(a,{name:"index",hash:{},data:o,loc:{start:{line:4,column:252},end:{line:4,column:261}}}):s)+'">'+u(typeof(s=null!=(s=n.w||(null!=t?t.w:t))?s:c)===l?s.call(a,{name:"w",hash:{},data:o,loc:{start:{line:4,column:263},end:{line:4,column:268}}}):s)+'</span><span class="move-item b-move" data-fen="'+u(typeof(s=null!=(s=n.b_fen||(null!=t?t.b_fen:t))?s:c)===l?s.call(a,{name:"b_fen",hash:{},data:o,loc:{start:{line:4,column:316},end:{line:4,column:325}}}):s)+'" data-ply="'+u(typeof(s=null!=(s=n.b_ply||(null!=t?t.b_ply:t))?s:c)===l?s.call(a,{name:"b_ply",hash:{},data:o,loc:{start:{line:4,column:337},end:{line:4,column:346}}}):s)+'" data-color="b" data-score="'+u(typeof(s=null!=(s=n.b_score||(null!=t?t.b_score:t))?s:c)===l?s.call(a,{name:"b_score",hash:{},data:o,loc:{start:{line:4,column:375},end:{line:4,column:386}}}):s)+'" data-move="'+u(typeof(s=null!=(s=n.b||(null!=t?t.b:t))?s:c)===l?s.call(a,{name:"b",hash:{},data:o,loc:{start:{line:4,column:399},end:{line:4,column:404}}}):s)+'" data-from="'+u(f(null!=(i=null!=t?t.b_move_info:t)?i.from:i,t))+'" data-to="'+u(f(null!=(i=null!=t?t.b_move_info:t)?i.to:i,t))+'" data-captured="'+u(f(null!=(i=null!=t?t.b_move_info:t)?i.captured:i,t))+'" data-index="'+u(typeof(s=null!=(s=n.index||(null!=t?t.index:t))?s:c)===l?s.call(a,{name:"index",hash:{},data:o,loc:{start:{line:4,column:521},end:{line:4,column:530}}}):s)+'">'+u(typeof(s=null!=(s=n.b||(null!=t?t.b:t))?s:c)===l?s.call(a,{name:"b",hash:{},data:o,loc:{start:{line:4,column:532},end:{line:4,column:537}}}):s)+'</span><span class="move-value"></span>\r\n    </li>\r\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,o){var i;return'<ol class="move-list">\r\n'+(null!=(i=n.each.call(null!=t?t:e.nullContext||{},null!=t?t.SAN_move_list:t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:2,column:2},end:{line:6,column:11}}}))?i:"")+"</ol>"},useData:!0})},function(e,t,n){"use strict";var r=n(68),o=n(308),i=n(10),s=n(72);e.exports=r.extend({template:o,$el:$("#openinglist"),activeView:{},initialize:function(e){var t=this;this.model=e.model,i.openings.on("change:openings",(function(){t.render(),i.openings.openings.length})),i.opening.on("change:sel_move",(function(){i.opening.sel_move.Moves?function(e){if(e){var t=document.getElementById("opening-code"),n=document.getElementById("opening-rank"),r=document.getElementById("opening-name"),o=document.getElementById("opening-line"),i=s.getRanking(e.Code||""),a=i?"# "+i:"";t.innerHTML=e.Code?'<a target="_blank" title="Popularity Rank '+a+'.  Click for DB games." href="https://database.chessui.com/database/'+e.Code+'">'+e.Code+"</a>":"--",r.innerHTML=e.Name+e.Variation?e.Name+(e.Variation?" <small>"+e.Variation+"</small>":""):"",o.innerHTML=""+e.Moves,$("#games-link").attr("href","https://database.chessui.com/database/"+e.Code),$("#games-name").text(e.Name),$("#games-link").show(),n.innerHTML=a,$("#game-opening").removeClass("is-dim")}}(i.opening.sel_move):$("#game-opening").addClass("is-dim")}))},render:function(){return this.model.is_empty?this.$el.addClass("is-empty"):this.$el.removeClass("is-empty"),this.$el.html(this.template(i.openings)),this}})},function(e,t,n){"use strict";e.exports=n(309)},function(e,t,n){var r=n(45);e.exports=(r.default||r).template({1:function(e,t,n,r,o){return'<section class="movelist">\n'},3:function(e,t,n,r,o){return'  <section class="no-moves">\n'},5:function(e,t,n,r,o){var i,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,c="function",l=e.escapeExpression;return'    <li data-index="'+l(typeof(i=null!=(i=n.index||(null!=t?t.index:t))?i:a)===c?i.call(s,{name:"index",hash:{},data:o,loc:{start:{line:9,column:20},end:{line:9,column:29}}}):i)+'">\n     <div class="group opening-options">\n       <div class="opening-code"><a href="https://database.chessui.com/database/'+l(typeof(i=null!=(i=n.Code||(null!=t?t.Code:t))?i:a)===c?i.call(s,{name:"Code",hash:{},data:o,loc:{start:{line:11,column:80},end:{line:11,column:88}}}):i)+'" target="_blank">'+l(typeof(i=null!=(i=n.Code||(null!=t?t.Code:t))?i:a)===c?i.call(s,{name:"Code",hash:{},data:o,loc:{start:{line:11,column:106},end:{line:11,column:114}}}):i)+"</a></div>\n       <div>\n         "+l(typeof(i=null!=(i=n.Name||(null!=t?t.Name:t))?i:a)===c?i.call(s,{name:"Name",hash:{},data:o,loc:{start:{line:13,column:9},end:{line:13,column:17}}}):i)+"<small>"+l(typeof(i=null!=(i=n.Variation||(null!=t?t.Variation:t))?i:a)===c?i.call(s,{name:"Variation",hash:{},data:o,loc:{start:{line:13,column:24},end:{line:13,column:37}}}):i)+"</small><div>"+l(typeof(i=null!=(i=n.Moves||(null!=t?t.Moves:t))?i:a)===c?i.call(s,{name:"Moves",hash:{},data:o,loc:{start:{line:13,column:50},end:{line:13,column:59}}}):i)+"</div>\n       </div>\n    </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,o){var i,s,a=null!=t?t:e.nullContext||{},c=e.escapeExpression;return(null!=(i=n.if.call(a,null!=(i=null!=t?t.subset:t)?i.length:i,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(3,o,0),data:o,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?i:"")+"<h5>Possible Lines ("+c(e.lambda(null!=(i=null!=t?t.subset:t)?i.length:i,t))+c("function"==typeof(s=null!=(s=n.setString||(null!=t?t.setString:t))?s:e.hooks.helperMissing)?s.call(a,{name:"setString",hash:{},data:o,loc:{start:{line:6,column:37},end:{line:6,column:50}}}):s)+' <small>randomized options</small>)</h5>\n<ul class="move-list">\n'+(null!=(i=n.each.call(a,null!=t?t.subset:t,{name:"each",hash:{},fn:e.program(5,o,0),inverse:e.noop,data:o,loc:{start:{line:8,column:2},end:{line:16,column:11}}}))?i:"")+"</ul>\n</section>"},useData:!0})},function(e,t,n){var r=n(10),o=n(311),i=n(312),s=n.e(0).then(n.bind(null,317)),a={switchTurn:function(e){this.stopTimers();var t=this.getTime(),n=this.checkGameEvent();if(r.opening.completed){var i=o.checkOtherLines();r.openings.set("openings",i.slice())}else o.updateFiltered().then((function(e){r.openings.set("openings",e.slice())}));if(n)this.setResult(),this.endGame();else{if(r.GAME.turn=r.chess.turn(),this.flipTimer(r.GAME.turn),r.moves.currentFEN=r.chess.fen()+"",r.GAME.player_turn="player"===e,"engine"===e)this.engineIndicator(),this.engineMove(t);else{this.playerIndicator();var s=r.moves.currentFEN;s.replace(/\s.+/g,"").replace(/\//g,"").split("").reduce((function(e,t){return/\D/.test(t)?e+1:e}),0)<=6&&(console.log("We can look up this in a table"),this.loadSyzygyTable(s)),this.hideSettings()}this.startTimer(r.GAME.turn),$("#custom-fen").val(r.moves.currentFEN)}},hideSettings:function(){r.GAME.in_progress?setTimeout((function(){return $(".main-container").addClass("game-start")}),2e3):$(".main-container").removeClass("game-start")},showIndicator:function(e){$(".player-indicator").removeClass("animate flash").addClass("hide"),$("#".concat(e,"-name")).find(".fa").addClass("animate flash").removeClass("hide")},engineIndicator:function(){this.showIndicator("top")},playerIndicator:function(){this.showIndicator("bottom")},checkGameEvent:function(){return r.chess.game_over()},getResult:function(){var e=r.chess,t=e.in_stalemate()||e.in_draw(),n=e.in_checkmate(),o=r.settings.player_color,i=e.turn();return n?o!==i?2:0:t?1:void 0},setResult:function(){r.GAME.result=this.getResult()},getPlayerColor:function(){return r.chess.turn()},getCurrentFEN:function(){return r.board.fen()},getCurrentGame:function(){return r.chess.history()},isPlayerTurn:function(){return r.chess.turn()===r.settings.player_color},undoMove:function(){var e=this,t=$("#undo");t.hide();var n=r.chess.undo();if(r.undoTimeout&&clearTimeout(r.undoTimeout),n){var o=r.chess.fen(),i=this.isPlayerTurn()?"player":"engine",s=r.GAME.turn,a=r.moves.SAN_move_list.length;if(0===a)return;r.board.position(o,!1),r.moves.move_list.pop(),r.moves.FEN_positions.pop(),"b"===s?r.moves.SAN_move_list.pop():delete r.moves.SAN_move_list[a-1].b,r.ga.event("In Game Event","Took back move"),r.moves_list.render(),t.show(),r.GAME.gettingMove&&r.GAME.gettingMove.reject(),r.undoTimeout=setTimeout((function(){e.switchTurn(i)}),3e3)}},rewindToMove:function(e,t){var n=e,o=t.index,i=t.ply,s=t.rewind_turn;if(i&&!(i<1)){var a=new Chess;r.moves.move_list.slice(0,i).forEach((function(e){var t=e.slice(0,2),n=e.slice(2,5);a.move({from:t,to:n})})),r.chess=a,r.board.position(n,!1),r.GAME.turn=s,r.moves.currentFEN=n;r.moves.move_list=r.moves.move_list.slice(0,i),r.moves.FEN_positions=r.moves.FEN_positions.slice(0,i),r.moves.SAN_move_list=r.moves.SAN_move_list.slice(0,o+1),r.moves.player_captures.slice(0,i),r.moves.engine_captures.slice(0,i);var c=r.settings.player_color===s?"player":"engine";"b"===s&&(delete r.moves.SAN_move_list[o].b,delete r.moves.SAN_move_list[o].b_fen,delete r.moves.SAN_move_list[o].b_move_info,delete r.moves.SAN_move_list[o].b_ply),$("#score").text("--"),r.sm_chart.data.datasets[0].data.slice(0,i),r.sm_chart.data.datasets[1].data.slice(0,i),r.moves_list.render(),$("#movelist").animate({scrollTop:$("#movelist")[0].scrollHeight},600),$("#review_board_container").removeClass("shown"),$("#move_label").html(""),$("#review_fen").val(""),r.GAME.gettingMove&&r.GAME.gettingMove.reject(),this.switchTurn(c)}},setPlayerColor:function(e){},flipBoard:function(e){var t=e?"black":"white";r.board.orientation(t)},flipTimer:function(e){},startTimer:function(e){},createTimers:function(){},stopTimers:function(){},timerTriggerEvent:function(){},timers:{},updateMoves:function(e,t,n,o){r.moves.move_list.push(e);var i=r.moves.move_list.length,s=r.chess.history().slice().pop(),a=r.chess.fen(),c=r.moves.SAN_move_list.length,l=r.moves.cid;if(n&&(n.index=i+1,r.moves.ponder_list.push(n)),"w"===r.GAME.turn)r.moves.SAN_move_list.push({w:s,w_fen:a+"",w_move_info:t,w_ply:i,index:c}),c++;else{var u=c-1>=0?c-1:0;0===c&&(r.moves.SAN_move_list.push({w:"",w_fen:"",w_move_info:{},index:c}),c++),r.moves.SAN_move_list[u].b=s,r.moves.SAN_move_list[u].b_fen=a+"",r.moves.SAN_move_list[u].b_move_info=t,r.moves.SAN_move_list[u].b_ply=i}r.GAME.turn===r.settings.player_color?r.moves.player_captures.push(t.captured):r.moves.engine_captures.push(t.captured),this.getEval(r.GAME.turn,c,l),r.moves_list.render(),$("#movelist").animate({scrollTop:$("#movelist")[0].scrollHeight},600),r.moves.FEN_positions.push(r.chess.fen()),this.updateChart("material")},getEval:function(e,t,n){var o=r.moves.move_list.join(" ");r.Eval.getEval(o,e,t,n)},updateCapPieces:function(){},updateCapPieceScores:function(){},reloadGame:function(){},validateCustomPos:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""!==e){var t=new Chess,n=t.validate_fen(e);return t=null,n}},loadCustomPos:function(e,t){var n=this.setInitialPos(e);t||this.setCustomTurn(n)},updatePlayerName:function(){},updateEngineSetting:function(e,t){},loadChart:function(){},updateChart:function(e){if("material"===e){var t=r.sm_chart.data.datasets[1].data,n=r.moves.player_material_total;t.push(n),t.length>25&&t.shift(),r.sm_chart.update()}},syzygyShow:function(e,t){var n=t.wdl?{2:"winning",1:"cursed win (not within 50 moves)",0:"draw","-1":"blessed loss","-2":"loss"}[t.wdl]:"",r=t.wdl&&{2:"green",1:"gray",0:"yellow","-1":"gray","-2":"red"}[t.wdl]||"";$("#syzygy-mate").text(t.dtm||""),$("#syzygy-move").text(e&&e.san||""),n&&$("#syzygy-result").text(n).addClass("result-color "+r)},loadSyzygyTable:function(e){var t=this;$.get("https://0oony77obd.execute-api.us-east-1.amazonaws.com/sr?fen=".concat(e)).then((function(e){(t.$endTable.removeClass("hide-end"),e)&&(e.moves&&e.moves.length>0&&(bestmove=e.moves[0]),!bestmove||"null"==typeof e.wdl||"null"==typeof e.dtm&&"null"==typeof e.dtz||t.syzygyShow(bestmove,e))})).fail((function(){t.resetSyzygyTable(),console.log("Fail retrieving table")}))},resetSyzygyTable:function(){this.$endTable.addClass("hide-end").find(".syzygy-item").each((function(e,t){$(t).text("")})),this.syzygyShow({san:null},{dtm:null,dtz:null,wdl:null})},resetBook:function(){this.$book.html(""),this.loadLockedOp(),this.startUpBook()},showBook:function(){},bookTemplate:function(e){var t,n=e.links,r=e.eco,o=(e.moves,e.name);if(!e||!n)return"";if(/00/.test(r))t=n.map(this.linkTemplate);else{if(!n.length)return"";var i=n.length>1?n.sort((function(e,t){return e.length-t.length})).pop():n.pop();t=this.linkTemplate(i)}return'<li><div class="first-line"><span class="eco">'.concat(r,"</span><span>").concat(o,"</span></div><div>").concat(t,"</div></li>")},linkTemplate:function(e){return'<a class="book-link" href="'.concat(e.href,'" title="').concat(e.title,'" target="_blank">').concat(e.title,"</a>")},iterateThrough:function(e){var t,n=[];for(t in e)n.push(e[t]);return n.slice()},renderBook:function(e){var t=this.iterateThrough(e).map(this.bookTemplate.bind(this));$("#game-opening-list").css("display","block"),this.$book.html(t)},resetChart:function(){r.sm_chart&&r.sm_chart.destroy(),r.sm_chart=new Chart.Line(r.flow.sm_ctx,{type:"line",options:{responsive:!1},data:{labels:[0],datasets:[{label:"game score",data:[0],borderColor:"rgba(102, 255, 153, 0.6)",backgroundColor:"rgba(102, 255, 153, 0.3)"},{label:"material +/-",data:[0],borderColor:"rgba(75,192,192,0.28)",backgroundColor:"rgba(75,192,192,0.4)"}]}})},resetBoard:function(){r.board.start()},resizeBoard:function(){r.board.resize()},backtrackToPos:function(e,t){},processSnapshot:function(){},setInitialPos:function(e){return r.GAME.custom_game=!0,r.GAME.custom_FEN=e+"",r.chess.load(e),r.board.position(e),r.chess.turn()},resetGame:function(){r.chess=new Chess},resetEngine:function(){},resolveOpeningState:function(e,t){e?r.opening.$def.resolve(t):r.opening.$def.reject("No book opening found")},loadLockedOp:function(){var e=localStorage.getItem("locked_op"),t={};e&&(t=JSON.parse(e),r.opening.set("use_locked",!0),r.opening.set("lock_move",t),r.opening.set("sel_move",t)),$("#lock-opening").css("color","#000"),$("#lock-opening").toggleClass("unlocked",!r.opening.use_locked)},startUpBook:function(){o.bookSetup()},tryLineOrElse:function(e){},processMoveArr:function(e){var t=this.getTime();if(0!==e.length){var n,i=r.moves.move_number,s=!1,a=[];if(r.opening.use_locked){var c=r.opening.lock_move,l=o.getCurrentMoveList();if(o.lineWorks(r.opening.lock_move,l))n=c.Moves.split(" ")[i],s=!0,$("#lock-opening").show(),$("#lock-opening").css("color","#000");else $("#lock-opening").css("color","#ccc")}if((a=s?[]:e.filter((function(e){return e.Moves.split(" ")[i]}))).length&&(r.opening.set("sel_move",a.pop()),n=r.opening.sel_move.Moves.split(" ")[i]),n)try{if(!r.flow.trySANMove(n))throw"illegal move"}catch(e){r.CE.makeMove(t)}else r.CE.makeMove(t)}else r.CE.makeMove(t)},engineMove:function(e){r.GAME.custom_game;if(r.opening.completed){var t=o.checkOtherLines();this.processMoveArr(t)}else{var n=this;o.updateFiltered().then(this.processMoveArr.bind(this)).catch((function(){var e=n.getTime();r.CE.makeMove(e)}))}},trySANMove:function(e){var t=r.chess,n=r.flow,o=t.move(e);if(null===o)return!1;var i=o.from+o.to;return n.updateMoves(i,o),n.executeEngineMove(o),!0},executeEngineMove:function(e){var t=r.chess,n=r.board;r.settings.show_last_enginemove&&e&&e.to&&$("#board").find(".square-"+e.to).addClass("square-highlight-move-border"),n.position(t.fen(),!1),this.switchTurn("player")},playerMoved:function(e){e&&$("#board").find(".square-highlight-move-border").removeClass("square-highlight-move-border"),this.switchTurn("engine")},getTime:function(){return{wtime:"60000",btime:"60000"}},resetTimers:function(){},showResult:function(e){var t=["You Lose","Draw","You win"],n=void 0!==e?e:this.getResult();new i({type:["error","warning","success"][n],text:t[n],theme:"relax",killer:!0,animation:{open:"animated bounceInRight",close:"animated bounceOutRight",easing:"swing",speed:500},timeout:2e3}).show();r.ga.event("Game Ended",t[n])},resetAll:function(){r.moves=r.resetModel("Moves"),r.moves_list.render(),r.moves_list.model=r.moves,r.moves_list.render(),r.engine_moves=r.resetModel("Engine"),r.opening.set("sel_line",{})},getPlayerSettings:function(){},resetMoveList:function(){$("#review_board_container").removeClass("shown"),$("#move_label").text(""),r.review_board&&r.review_board.position("start")},setCustomTurn:function(e){r.GAME.turn=e},resetState:function(){var e=r.GAME;e.in_progress=!0,e.turn="w",e.result=0,e.check_local_book=!0,e.game_state="new",e.opening="",e.game_available_actions=["Resign","Draw"]},endGame:function(e){r.GAME.in_progress=!1,r.GAME.player_turn=!1,this.stopTimers(),this.showResult(e),$(".main-container").removeClass("game-start"),$("#game-resign, #game-draw").hide(),$("#game-new, #load-fen").show()},requestDraw:function(){return!!r.chess.in_threefold_repetition()&&(this.setResult(),this.endGame(1),!0)},resign:function(){this.endGame(0)},saveLastGame:function(){"over"===r.GAME.game_state&&localStorage.set("chess_last_pos",r.moves.currentFEN)},reloadLastGame:function(){},jumpToPos:function(){},analyzePos:function(){},newGame:function(e,t){var n=r.GAME;n.in_progress&&(n.in_progress=!1),this.saveLastGame(),this.resetBoard(),this.resetGame(),this.resetAll(),this.resetBook(),this.resetSyzygyTable(),this.resetState(),this.getPlayerSettings(),this.updateUI(),e?this.loadCustomPos(t):(n.custom_game=!1,n.custom_FEN=""),this.beginGame()},updateUI:function(e){var t=r.settings.player_color;this.resetTimers(),this.resetChart(),this.resetMoveList(),this.flipBoard(r.settings.flip),this.updatePlayerName(t),r.GAME.in_progress&&setTimeout((function(){return $(".main-container").addClass("game-start")}),1e3),r.CE.resetCanvas(!1)},beginGame:function(){r.GAME.in_progress=!0,r.GAME.player_turn=!1;var e=this.getTime();r.CE.startNewGame(),r.CE.resetCanvas(!0),"w"===r.GAME.turn&&"b"===r.settings.player_color?(this.engineMove(e),this.engineIndicator()):(this.playerIndicator(),r.GAME.player_turn=!0),i&&(i.closeAll(),i.clearQueue()),$("#kibitz").find("ul").html(""),$("#kibitz-status").text("Using book"),$("#score").html(""),$("#player-score").html(""),$("#game-resign, #game-draw").show(),$("#uci-raw").empty(),$("#custom-fen").val(""),r.ga.event("Changed Game State","New game")},startFromFen:function(){var e=$("#custom-fen").val(),t=a.validateCustomPos(e||"");e&&t?(a.newGame(!0,e),r.ga.event("New Game","Custom Game"),$("#modal").addClass("hide").removeClass("show-odds show-train")):$("#modal").find(".error").removeClass("hide")},getColorSetting:function(){return $('[name="player_color"]').get(0).checked?"w":"b"},shouldFlip:function(){return"b"===this.getColorSetting()},startFenBoard:function(e){var t={draggable:!0,dropOffBoard:"trash",moveSpeed:"fast",sparePieces:!0,onChange:a.handleTrainingPos,onDrop:function(e){return!0},onDragStart:function(e){return!0},position:"start"};if(!r.fen_board){r.boardFn.init([{name:"fen_board",config:t,override:e}],r);var n=a.shouldFlip();try{n&&r.fen_board.orientation("black")}catch(e){}}},getCastlingOptions:function(e,t){var n=e.match(/k\w{2,2}r/i)?"k":"",r=e.match(/r\w{3,3}k/i)?"q":"",o="".concat(n).concat(r);return"w"===t?o.toUpperCase():o},castlingStrings:function(e){var t=e.replace(/\ .*/,"").split("/"),n=t[0],r=t[7];return a.getCastlingOptions(r,"w")+a.getCastlingOptions(n,"b")||"-"},fenFix:function(e){if(e.split(" ").length<2){var t=a.castlingStrings(e);return"".concat(e," w ").concat(t," - 0 1")}return e},handleTrainingPos:function(e,t){var n=ChessBoard.objToFen(t);if(n){var r=a.fenFix(n);$("#custom-fen").val(r)}},searchOB:function(){},init:function(e){if(r.flow=a,r.flow.sm_ctx=document.getElementById("gameScores").getContext("2d"),this.$endTable=$("#game-end-game"),this.$book=$("#game-opening-list").find("ul"),this.$book.on("click",".book-link",(function(e){var t=e.target.innerText;r.ga.event("Book",t)})),this.loadLockedOp(),o.bookSetup(),this.updateUI(),this.beginGame(),i)new i({type:"information",text:"Welcome!  Started a new game.",theme:"relax",killer:!0,animation:{open:"animated bounceInRight",close:"animated bounceOutRight",easing:"swing",speed:500},timeout:2e3}).show();$("#game-new").click((function(){a.newGame()})),$("#load-fen").click((function(){$("#modal").removeClass("hide show-odds show-train").addClass("show-entry"),r.ga.event("Training Board","Show Custom FEN Entry"),a.startFenBoard(!0)})),$("#load-odds").click((function(){$("#modal").removeClass("hide show-entry show-train").addClass("show-odds"),r.ga.event("Training Board","Show Odds"),a.startFenBoard(!0)})),$("#load-training").click((function(){$("#modal").removeClass("hide show-entry show-odds").addClass("show-train");$.noop;r.ga.event("Training Board","Show Training"),a.startFenBoard(!0)})),$(".load-gen-action").click((function(){a.startFromFen()})),$("#load-fen-action").click((function(){var e=$("#custom-fen-entry").val(),t=a.validateCustomPos(e||"");e&&t?(a.newGame(!0,e),$("#modal").addClass("hide").removeClass("show-entry"),$("#custom-fen").val(e)):$("#modal").find(".error").removeClass("hide")})),$("#custom-fen-entry").on("change",(function(e){$("#modal").find(".error").addClass("hide")})).on("paste, keydown",(function(e){e.stopPropagation();var t=e&&e.target&&e.target.value||"";r&&r.fen_board&&(r.ga.event("Training Board","Custom FEN"),r.fen_board.position(t))})),$("#training-select").on("change",(function(e){var t=e&&e.target&&e.target.value||"";if("none"!==t){var n=a.getColorSetting();s.then((function(e){var o=e.getTrainingPosition(n,t),i=e.getTrainingPosition("desc",t)||"",s=e.getTrainingPosition("ref",t)||"",c=a.validateCustomPos(o||"");$("#train-desc").text(i),$("#train-ref").attr("href",s).text(s),o&&c&&r.fen_board&&(r.ga.event("Training Board",t),r.fen_board.position(o),$("#custom-fen").val(o))}))}})),$("#start-fen-pos").click((function(e){r.fen_board.start()})),$("#clear-fen-pos").click((function(e){r.fen_board.clear()})),$("#set-fen-entry").click((function(e){var t=$("#custom-fen-entry").val();r&&r.fen_board&&t&&r.fen_board.position(t)})),$("#specific-opening").change((function(e){e.target.value&&r.settings.set("preferred_eco",e.target.val)})),$(".cancel-modal-action").click((function(){$("#modal").addClass("hide").removeClass("show-entry show-odds show-train"),r.ga.event("modal","closed")})),$(".custom-preselects").on("click",".game-btn",(function(e){var t=e.currentTarget;if(t){var n=$(t).data("option"),o=$('[name="player_color"]').get(0).checked?"b":"w";s.then((function(e){var t=e.getPosition(o,n),i=a.validateCustomPos(t||"");t&&i&&r.fen_board&&(r.fen_board.position(t),$("#custom-fen").val(t))}))}})),$("#game-settings-menu").click((function(){$("#top-header").toggleClass("open")})),$("#lock-opening").click((function(){var e=!r.opening.use_locked;if(r.opening.set("use_locked",e),r.ga.event("opening","locked"),e){if(r.opening.set("lock_move",r.opening.sel_move),localStorage.setItem("locked_op",JSON.stringify(r.opening.lock_move)),i){var t=r.opening.sel_move&&r.opening.sel_move.Code,n=r.opening.sel_move&&r.opening.sel_move.Name;new i({type:"information",text:"Locking the opening to ".concat(t||"").concat(n?": "+n:""),theme:"relax",killer:!0,animation:{open:"animated bounceInRight",close:"animated bounceOutRight",easing:"swing",speed:500},timeout:1500}).show()}}else if(r.opening.set("lock_move",{}),r.ga.event("opening","unlocked"),localStorage.removeItem("locked_op"),i)new i({type:"information",text:"Unlocked opening.  Will randomly select opening when possible.",theme:"relax",killer:!0,animation:{open:"animated bounceInRight",close:"animated bounceOutRight",easing:"swing",speed:300},timeout:1e3}).show();$(this).toggleClass("unlocked",!r.opening.use_locked)})),$("#undo").click(a.undoMove.bind(a)),$("#game-draw").click((function(e){if(e.preventDefault(),e.stopPropagation(),a.requestDraw())$("#game-new, #load-fen").show(),$("#game-draw, #game-resign").hide();else if(i)new i({type:"information",text:"Draw declined.",theme:"relax",killer:!0,animation:{open:"animated bounceInRight",close:"animated bounceOutRight",easing:"swing",speed:500},timeout:2e3}).show()})),$("#game-resign").click((function(){a.resign(),$("#game-new, #load-fen").show(),$("#game-draw, #game-resign").hide()}))}};e.exports=a},function(e,t,n){var r=n(10),o=n(72);function i(e,t){return e.filter((function(e){return 0===(e.Moves||"").trim().indexOf(t.trim())}))}function s(e){for(var t=e.length;t>0;){var n=Math.floor(Math.random()*t),r=e[--t];e[t]=e[n],e[n]=r}return e}function a(){return r.moves.SAN_move_list.map((function(e){return e.w+(e.b?" "+e.b:"")})).join(" ")}function c(e){var t=a();r.opening.active_pos=t;var n=[],o=i(r.opening.filtered,t);o.length>0?n=o.slice():n=i(r.opening.lines,t).slice();return e?s(n).slice():n.slice()}var l={bookSetup:function(){var e=function(){var e=$("#opening-filter option").map((function(e,t){return t.value}));r.opening.options=e.get();var t=r.opening.opts;return t||""}(),t={msg:"filter",move:"",keyword:r.settings.preferred_style||e};r.openings.set("openings",[]),r.opening.requested=!1,r.opening.completed=!1,r.opening.$def=$.Deferred(),r.ECO.post(t);var n=localStorage.getItem("chess_totals");if(n){var i=JSON.parse(n);o.saveRankings(i)}else r.ECO.post({msg:"get_totals"});$.when(r.opening.$def).then((function(e){r.opening.requested=!0,r.opening.completed=!0,function(e){var t=r.opening,n=e.filtered,o=e.lines,i=n.length>0?n:o;t.lines=o,t.filtered=n;var a=s(i).slice();r.opening.requested=!0,r.opening.completed=!0,r.openings.set("openings",a)}(e)})).fail((function(e){console.log("Rejected")}))},checkOtherLines:c,lineWorks:function(e,t){return 0===(e.Moves||"").trim().indexOf(t.trim())},shuffle:s,getCurrentMoveList:a,updateFiltered:function(){return $.when(r.opening.$def).then((function(){return c()}))}};e.exports=l},function(e,t,n){
/* 
  @package NOTY - Dependency-free notification library 
  @version version: 3.2.0-beta 
  @contributors https://github.com/needim/noty/graphs/contributors 
  @documentation Examples and Documentation - https://ned.im/noty 
  @license Licensed under the MIT licenses: http://www.opensource.org/licenses/mit-license.php 
*/
var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.css=t.deepExtend=t.animationEndEvents=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.inArray=function(e,t,n){var r=void 0;if(n){for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return!0}else for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return!0;return!1},t.stopPropagation=function(e){void 0!==(e=e||window.event).stopPropagation?e.stopPropagation():e.cancelBubble=!0},t.generateID=function(){var e="noty_"+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")+"_";return e+="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.outerHeight=function(e){var t=e.offsetHeight,n=window.getComputedStyle(e);return t+=parseInt(n.marginTop)+parseInt(n.marginBottom)},t.addListener=i,t.hasClass=s,t.addClass=function(e,t){var n=c(e),r=n+t;s(n,t)||(e.className=r.substring(1))},t.removeClass=function(e,t){var n=c(e),r=void 0;s(e,t)&&(r=n.replace(" "+t+" "," "),e.className=r.substring(1,r.length-1))},t.remove=a,t.classList=c,t.visibilityChangeFlow=function(){var e=void 0,t=void 0;function n(){o.PageHidden?setTimeout((function(){Object.keys(o.Store).forEach((function(e){o.Store.hasOwnProperty(e)&&o.Store[e].options.visibilityControl&&o.Store[e].stop()}))}),100):setTimeout((function(){Object.keys(o.Store).forEach((function(e){o.Store.hasOwnProperty(e)&&o.Store[e].options.visibilityControl&&o.Store[e].resume()})),o.queueRenderAll()}),100)}void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),t&&i(document,t,(function(){o.PageHidden=document[e],n()})),i(window,"blur",(function(){o.PageHidden=!0,n()})),i(window,"focus",(function(){o.PageHidden=!1,n()}))},t.createAudioElements=function(e){if(e.hasSound){var t=document.createElement("audio");e.options.sounds.sources.forEach((function(e){var n=document.createElement("source");n.src=e,n.type="audio/"+e.match(/\.([^.]+)$/)[1],t.appendChild(n)})),e.barDom?e.barDom.appendChild(t):document.querySelector("body").appendChild(t),t.volume=e.options.sounds.volume,e.soundPlayed||(t.play(),e.soundPlayed=!0),t.onended=function(){a(t)}}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1));function i(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t=t.split(" ");for(var o=0;o<t.length;o++)document.addEventListener?e.addEventListener(t[o],n,r):document.attachEvent&&e.attachEvent("on"+t[o],n)}function s(e,t){return("string"==typeof e?e:c(e)).indexOf(" "+t+" ")>=0}function a(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e){return(" "+(e&&e.className||"")+" ").replace(/\s+/gi," ")}t.animationEndEvents="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",t.deepExtend=function e(t){t=t||{};for(var n=1;n<arguments.length;n++){var o=arguments[n];if(o)for(var i in o)o.hasOwnProperty(i)&&(Array.isArray(o[i])?t[i]=o[i]:"object"===r(o[i])&&null!==o[i]?t[i]=e(t[i],o[i]):t[i]=o[i])}return t},t.css=function(){var e=["Webkit","O","Moz","ms"],t={};function n(n){return n=n.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()})),t[n]||(t[n]=function(t){var n=document.body.style;if(t in n)return t;for(var r=e.length,o=t.charAt(0).toUpperCase()+t.slice(1),i=void 0;r--;)if((i=e[r]+o)in n)return i;return t}(n))}function r(e,t,r){t=n(t),e.style[t]=r}return function(e,t){var n=arguments,o=void 0,i=void 0;if(2===n.length)for(o in t)t.hasOwnProperty(o)&&void 0!==(i=t[o])&&t.hasOwnProperty(o)&&r(e,o,i);else r(e,n[1],n[2])}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Defaults=t.Store=t.Queues=t.DefaultMaxVisible=t.docTitle=t.DocModalCount=t.PageHidden=void 0,t.getQueueCounts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global",t=0,n=a;return c.hasOwnProperty(e)&&(n=c[e].maxVisible,Object.keys(l).forEach((function(n){l[n].options.queue!==e||l[n].closed||t++}))),{current:t,maxVisible:n}},t.addToQueue=function(e){c.hasOwnProperty(e.options.queue)||(c[e.options.queue]={maxVisible:a,queue:[]}),c[e.options.queue].queue.push(e)},t.removeFromQueue=function(e){if(c.hasOwnProperty(e.options.queue)){var t=[];Object.keys(c[e.options.queue].queue).forEach((function(n){c[e.options.queue].queue[n].id!==e.id&&t.push(c[e.options.queue].queue[n])})),c[e.options.queue].queue=t}},t.queueRender=u,t.queueRenderAll=function(){Object.keys(c).forEach((function(e){u(e)}))},t.ghostFix=function(e){var t=r.generateID("ghost"),n=document.createElement("div");n.setAttribute("id",t),r.css(n,{height:r.outerHeight(e.barDom)+"px"}),e.barDom.insertAdjacentHTML("afterend",n.outerHTML),r.remove(e.barDom),n=document.getElementById(t),r.addClass(n,"noty_fix_effects_height"),r.addListener(n,r.animationEndEvents,(function(){r.remove(n)}))},t.build=function(e){!function(e){if(e.options.container)e.layoutDom=document.querySelector(e.options.container);else{var t="noty_layout__"+e.options.layout;e.layoutDom=document.querySelector("div#"+t),e.layoutDom||(e.layoutDom=document.createElement("div"),e.layoutDom.setAttribute("id",t),e.layoutDom.setAttribute("role","alert"),e.layoutDom.setAttribute("aria-live","polite"),r.addClass(e.layoutDom,"noty_layout"),document.querySelector("body").appendChild(e.layoutDom))}}(e);var t='<div class="noty_body">'+e.options.text+"</div>"+function(e){if(f(e)){var t=document.createElement("div");return r.addClass(t,"noty_buttons"),Object.keys(e.options.buttons).forEach((function(n){t.appendChild(e.options.buttons[n].dom)})),e.options.buttons.forEach((function(e){t.appendChild(e.dom)})),t.outerHTML}return""}(e)+'<div class="noty_progressbar"></div>';e.barDom=document.createElement("div"),e.barDom.setAttribute("id",e.id),r.addClass(e.barDom,"noty_bar noty_type__"+e.options.type+" noty_theme__"+e.options.theme),e.barDom.innerHTML=t,h(e,"onTemplate")},t.hasButtons=f,t.handleModal=function(e){var n,i;e.options.modal&&(0===o&&(n=document.querySelector("body"),i=document.createElement("div"),r.addClass(i,"noty_modal"),n.insertBefore(i,n.firstChild),r.addClass(i,"noty_modal_open"),r.addListener(i,r.animationEndEvents,(function(){r.removeClass(i,"noty_modal_open")}))),t.DocModalCount=o+=1)},t.handleModalClose=function(e){if(e.options.modal&&o>0&&(t.DocModalCount=o-=1,o<=0)){var n=document.querySelector(".noty_modal");n&&(r.removeClass(n,"noty_modal_open"),r.addClass(n,"noty_modal_close"),r.addListener(n,r.animationEndEvents,(function(){r.remove(n)})))}},t.queueClose=d,t.dequeueClose=p,t.fire=h,t.openFlow=function(e){h(e,"afterShow"),d(e),r.addListener(e.barDom,"mouseenter",(function(){p(e)})),r.addListener(e.barDom,"mouseleave",(function(){d(e)}))},t.closeFlow=function(e){delete l[e.id],e.closing=!1,h(e,"afterClose"),r.remove(e.barDom),0!==e.layoutDom.querySelectorAll(".noty_bar").length||e.options.container||r.remove(e.layoutDom),(r.inArray("docVisible",e.options.titleCount.conditions)||r.inArray("docHidden",e.options.titleCount.conditions))&&s.decrement(),u(e.options.queue)};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.PageHidden=!1;var o=t.DocModalCount=0,i={originalTitle:null,count:0,changed:!1,timer:-1},s=t.docTitle={increment:function(){i.count++,s._update()},decrement:function(){i.count--,i.count<=0?s._clear():s._update()},_update:function(){var e=document.title;i.changed?document.title="("+i.count+") "+i.originalTitle:(i.originalTitle=e,document.title="("+i.count+") "+e,i.changed=!0)},_clear:function(){i.changed&&(i.count=0,document.title=i.originalTitle,i.changed=!1)}},a=t.DefaultMaxVisible=5,c=t.Queues={global:{maxVisible:a,queue:[]}},l=t.Store={};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global";if(c.hasOwnProperty(e)){var t=c[e].queue.shift();t&&t.show()}}function f(e){return!(!e.options.buttons||!Object.keys(e.options.buttons).length)}function d(e){e.options.timeout&&(e.options.progressBar&&e.progressDom&&r.css(e.progressDom,{transition:"width "+e.options.timeout+"ms linear",width:"0%"}),clearTimeout(e.closeTimer),e.closeTimer=setTimeout((function(){e.close()}),e.options.timeout))}function p(e){e.options.timeout&&e.closeTimer&&(clearTimeout(e.closeTimer),e.closeTimer=-1,e.options.progressBar&&e.progressDom&&r.css(e.progressDom,{transition:"width 0ms linear",width:"100%"}))}function h(e,t){e.listeners.hasOwnProperty(t)&&e.listeners[t].forEach((function(t){"function"==typeof t&&t.apply(e)}))}t.Defaults={type:"alert",layout:"topRight",theme:"mint",text:"",timeout:!1,progressBar:!0,closeWith:["click"],animation:{open:"noty_effects_open",close:"noty_effects_close"},id:!1,force:!1,killer:!1,queue:"global",container:!1,buttons:[],callbacks:{beforeShow:null,onShow:null,afterShow:null,onClose:null,afterClose:null,onClick:null,onHover:null,onTemplate:null},sounds:{sources:[],volume:1,conditions:[]},titleCount:{conditions:[]},modal:!1,visibilityControl:!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotyButton=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.NotyButton=function e(t,n,i){var s=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o(this,e),this.dom=document.createElement("button"),this.dom.innerHTML=t,this.id=a.id=a.id||r.generateID("button"),this.cb=i,Object.keys(a).forEach((function(e){s.dom.setAttribute(e,a[e])})),r.addClass(this.dom,n||"noty_btn"),this}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Push=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/service-worker.js";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subData={},this.workerPath=t,this.listeners={onPermissionGranted:[],onPermissionDenied:[],onSubscriptionSuccess:[],onSubscriptionCancel:[],onWorkerError:[],onWorkerSuccess:[],onWorkerNotSupported:[]},this}return r(e,[{key:"on",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return"function"==typeof t&&this.listeners.hasOwnProperty(e)&&this.listeners[e].push(t),this}},{key:"fire",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.listeners.hasOwnProperty(e)&&this.listeners[e].forEach((function(e){"function"==typeof e&&e.apply(t,n)}))}},{key:"create",value:function(){console.log("NOT IMPLEMENTED YET")}},{key:"isSupported",value:function(){var e=!1;try{e=window.Notification||window.webkitNotifications||navigator.mozNotification||window.external&&void 0!==window.external.msIsSiteMode()}catch(e){}return e}},{key:"getPermissionStatus",value:function(){var e="default";if(window.Notification&&window.Notification.permissionLevel)e=window.Notification.permissionLevel;else if(window.webkitNotifications&&window.webkitNotifications.checkPermission)switch(window.webkitNotifications.checkPermission()){case 1:e="default";break;case 0:e="granted";break;default:e="denied"}else window.Notification&&window.Notification.permission?e=window.Notification.permission:navigator.mozNotification?e="granted":window.external&&void 0!==window.external.msIsSiteMode()&&(e=window.external.msIsSiteMode()?"granted":"default");return e.toString().toLowerCase()}},{key:"getEndpoint",value:function(e){var t=e.endpoint,n=e.subscriptionId;return n&&-1===t.indexOf(n)&&(t+="/"+n),t}},{key:"isSWRegistered",value:function(){try{return"activated"===navigator.serviceWorker.controller.state}catch(e){return!1}}},{key:"unregisterWorker",value:function(){var e=this;"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then((function(t){var n=!0,r=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0)i.value.unregister(),e.fire("onSubscriptionCancel")}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}}))}},{key:"requestSubscription",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this,r=this.getPermissionStatus(),o=function(r){"granted"===r?(e.fire("onPermissionGranted"),"serviceWorker"in navigator?navigator.serviceWorker.register(e.workerPath).then((function(){navigator.serviceWorker.ready.then((function(e){n.fire("onWorkerSuccess"),e.pushManager.subscribe({userVisibleOnly:t}).then((function(e){var t=e.getKey("p256dh"),r=e.getKey("auth");n.subData={endpoint:n.getEndpoint(e),p256dh:t?window.btoa(String.fromCharCode.apply(null,new Uint8Array(t))):null,auth:r?window.btoa(String.fromCharCode.apply(null,new Uint8Array(r))):null},n.fire("onSubscriptionSuccess",[n.subData])})).catch((function(e){n.fire("onWorkerError",[e])}))}))})):n.fire("onWorkerNotSupported")):"denied"===r&&(e.fire("onPermissionDenied"),e.unregisterWorker())};"default"===r?window.Notification&&window.Notification.requestPermission?window.Notification.requestPermission(o):window.webkitNotifications&&window.webkitNotifications.checkPermission&&window.webkitNotifications.requestPermission(o):o(r)}}]),e}()},function(e,t,n){(function(t,r){var o;
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.1.1
 */o=function(){"use strict";function e(e){return"function"==typeof e}var o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,s=void 0,a=void 0,c=function(e,t){v[i]=e,v[i+1]=t,2===(i+=2)&&(a?a(m):w())},l="undefined"!=typeof window?window:void 0,u=l||{},f=u.MutationObserver||u.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var e=setTimeout;return function(){return e(m,1)}}var v=new Array(1e3);function m(){for(var e=0;e<i;e+=2)(0,v[e])(v[e+1]),v[e]=void 0,v[e+1]=void 0;i=0}var g,_,b,y,w=void 0;function x(e,t){var n=arguments,r=this,o=new this.constructor(C);void 0===o[E]&&R(o);var i,s=r._state;return s?(i=n[s-1],c((function(){return B(s,o,i,r._result)}))):L(r,o,e,t),o}function k(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(C);return $(t,e),t}d?w=function(){return t.nextTick(m)}:f?(_=0,b=new f(m),y=document.createTextNode(""),b.observe(y,{characterData:!0}),w=function(){y.data=_=++_%2}):p?((g=new MessageChannel).port1.onmessage=m,w=function(){return g.port2.postMessage(0)}):w=void 0===l?function(){try{var e=n(9);return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(m)}:h()}catch(e){return h()}}():h();var E=Math.random().toString(36).substring(16);function C(){}var S=void 0,M=1,A=2,j=new q;function O(e){try{return e.then}catch(e){return j.error=e,j}}function T(t,n,r){n.constructor===t.constructor&&r===x&&n.constructor.resolve===k?function(e,t){t._state===M?N(e,t._result):t._state===A?D(e,t._result):L(t,void 0,(function(t){return $(e,t)}),(function(t){return D(e,t)}))}(t,n):r===j?(D(t,j.error),j.error=null):void 0===r?N(t,n):e(r)?function(e,t,n){c((function(e){var r=!1,o=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,(function(n){r||(r=!0,t!==n?$(e,n):N(e,n))}),(function(t){r||(r=!0,D(e,t))}),e._label);!r&&o&&(r=!0,D(e,o))}),e)}(t,n,r):N(t,n)}function $(e,t){var n,r;e===t?D(e,new TypeError("You cannot resolve a promise with itself")):(r=typeof(n=t),null===n||"object"!==r&&"function"!==r?N(e,t):T(e,t,O(t)))}function P(e){e._onerror&&e._onerror(e._result),F(e)}function N(e,t){e._state===S&&(e._result=t,e._state=M,0!==e._subscribers.length&&c(F,e))}function D(e,t){e._state===S&&(e._state=A,e._result=t,c(P,e))}function L(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+M]=n,o[i+A]=r,0===i&&e._state&&c(F,e)}function F(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?B(n,r,o,i):o(i);e._subscribers.length=0}}function q(){this.error=null}var I=new q;function B(t,n,r,o){var i=e(r),s=void 0,a=void 0,c=void 0,l=void 0;if(i){if((s=function(e,t){try{return e(t)}catch(e){return I.error=e,I}}(r,o))===I?(l=!0,a=s.error,s.error=null):c=!0,n===s)return void D(n,new TypeError("A promises callback cannot return that same promise."))}else s=o,c=!0;n._state!==S||(i&&c?$(n,s):l?D(n,a):t===M?N(n,s):t===A&&D(n,s))}var z=0;function R(e){e[E]=z++,e._state=void 0,e._result=void 0,e._subscribers=[]}function H(e,t){this._instanceConstructor=e,this.promise=new e(C),this.promise[E]||R(this.promise),o(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?N(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&N(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}function G(e){this[E]=z++,this._result=this._state=void 0,this._subscribers=[],C!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof G?function(e,t){try{t((function(t){$(e,t)}),(function(t){D(e,t)}))}catch(t){D(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return H.prototype._enumerate=function(e){for(var t=0;this._state===S&&t<e.length;t++)this._eachEntry(e[t],t)},H.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===k){var o=O(e);if(o===x&&e._state!==S)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===G){var i=new n(C);T(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},H.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===S&&(this._remaining--,e===A?D(r,n):this._result[t]=n),0===this._remaining&&N(r,this._result)},H.prototype._willSettleAt=function(e,t){var n=this;L(e,void 0,(function(e){return n._settledAt(M,t,e)}),(function(e){return n._settledAt(A,t,e)}))},G.all=function(e){return new H(this,e).promise},G.race=function(e){var t=this;return o(e)?new t((function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},G.resolve=k,G.reject=function(e){var t=new this(C);return D(t,e),t},G._setScheduler=function(e){a=e},G._setAsap=function(e){c=e},G._asap=c,G.prototype={constructor:G,then:x,catch:function(e){return this.then(null,e)}},G.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=G},G.Promise=G,G},e.exports=o()}).call(t,n(7),n(8))},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(5);var o,i=n(4),s=(o=i)&&o.__esModule?o:{default:o},a=f(n(0)),c=f(n(1)),l=n(2),u=n(3);function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=a.deepExtend({},c.Defaults,t),c.Store[this.options.id]?c.Store[this.options.id]:(this.id=this.options.id||a.generateID("bar"),this.closeTimer=-1,this.barDom=null,this.layoutDom=null,this.progressDom=null,this.showing=!1,this.shown=!1,this.closed=!1,this.closing=!1,this.killable=this.options.timeout||this.options.closeWith.length>0,this.hasSound=this.options.sounds.sources.length>0,this.soundPlayed=!1,this.listeners={beforeShow:[],onShow:[],afterShow:[],onClose:[],afterClose:[],onClick:[],onHover:[],onTemplate:[]},this.promises={show:null,close:null},this.on("beforeShow",this.options.callbacks.beforeShow),this.on("onShow",this.options.callbacks.onShow),this.on("afterShow",this.options.callbacks.afterShow),this.on("onClose",this.options.callbacks.onClose),this.on("afterClose",this.options.callbacks.afterClose),this.on("onClick",this.options.callbacks.onClick),this.on("onHover",this.options.callbacks.onHover),this.on("onTemplate",this.options.callbacks.onTemplate),this)}return r(e,[{key:"on",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return"function"==typeof t&&this.listeners.hasOwnProperty(e)&&this.listeners[e].push(t),this}},{key:"show",value:function(){var t=this;if(this.showing||this.shown)return this;!0===this.options.killer?e.closeAll():"string"==typeof this.options.killer&&e.closeAll(this.options.killer);var n=c.getQueueCounts(this.options.queue);if(n.current>=n.maxVisible||c.PageHidden&&this.options.visibilityControl)return c.addToQueue(this),c.PageHidden&&this.hasSound&&a.inArray("docHidden",this.options.sounds.conditions)&&a.createAudioElements(this),c.PageHidden&&a.inArray("docHidden",this.options.titleCount.conditions)&&c.docTitle.increment(),this;if(c.Store[this.id]=this,c.fire(this,"beforeShow"),this.showing=!0,this.closing)return this.showing=!1,this;if(c.build(this),c.handleModal(this),this.options.force?this.layoutDom.insertBefore(this.barDom,this.layoutDom.firstChild):this.layoutDom.appendChild(this.barDom),this.hasSound&&!this.soundPlayed&&a.inArray("docVisible",this.options.sounds.conditions)&&a.createAudioElements(this),a.inArray("docVisible",this.options.titleCount.conditions)&&c.docTitle.increment(),this.shown=!0,this.closed=!1,c.hasButtons(this)&&Object.keys(this.options.buttons).forEach((function(e){var n=t.barDom.querySelector("#"+t.options.buttons[e].id);a.addListener(n,"click",(function(n){a.stopPropagation(n),t.options.buttons[e].cb(t)}))})),this.progressDom=this.barDom.querySelector(".noty_progressbar"),a.inArray("click",this.options.closeWith)&&(a.addClass(this.barDom,"noty_close_with_click"),a.addListener(this.barDom,"click",(function(e){a.stopPropagation(e),c.fire(t,"onClick"),t.close()}),!1)),a.addListener(this.barDom,"mouseenter",(function(){c.fire(t,"onHover")}),!1),this.options.timeout&&a.addClass(this.barDom,"noty_has_timeout"),this.options.progressBar&&a.addClass(this.barDom,"noty_has_progressbar"),a.inArray("button",this.options.closeWith)){a.addClass(this.barDom,"noty_close_with_button");var r=document.createElement("div");a.addClass(r,"noty_close_button"),r.innerHTML="×",this.barDom.appendChild(r),a.addListener(r,"click",(function(e){a.stopPropagation(e),t.close()}),!1)}return c.fire(this,"onShow"),null===this.options.animation.open?this.promises.show=new s.default((function(e){e()})):"function"==typeof this.options.animation.open?this.promises.show=new s.default(this.options.animation.open.bind(this)):(a.addClass(this.barDom,this.options.animation.open),this.promises.show=new s.default((function(e){a.addListener(t.barDom,a.animationEndEvents,(function(){a.removeClass(t.barDom,t.options.animation.open),e()}))}))),this.promises.show.then((function(){var e=t;setTimeout((function(){c.openFlow(e)}),100)})),this}},{key:"stop",value:function(){return c.dequeueClose(this),this}},{key:"resume",value:function(){return c.queueClose(this),this}},{key:"setTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){if(this.stop(),this.options.timeout=e,this.barDom){this.options.timeout?a.addClass(this.barDom,"noty_has_timeout"):a.removeClass(this.barDom,"noty_has_timeout");var t=this;setTimeout((function(){t.resume()}),100)}return this}))},{key:"setText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.barDom&&(this.barDom.querySelector(".noty_body").innerHTML=e),t&&(this.options.text=e),this}},{key:"setType",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.barDom){var r=a.classList(this.barDom).split(" ");r.forEach((function(e){"noty_type__"===e.substring(0,11)&&a.removeClass(t.barDom,e)})),a.addClass(this.barDom,"noty_type__"+e)}return n&&(this.options.type=e),this}},{key:"setTheme",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.barDom){var r=a.classList(this.barDom).split(" ");r.forEach((function(e){"noty_theme__"===e.substring(0,12)&&a.removeClass(t.barDom,e)})),a.addClass(this.barDom,"noty_theme__"+e)}return n&&(this.options.theme=e),this}},{key:"close",value:function(){var e=this;return this.closed?this:this.shown?(c.fire(this,"onClose"),this.closing=!0,null===this.options.animation.close||!1===this.options.animation.close?this.promises.close=new s.default((function(e){e()})):"function"==typeof this.options.animation.close?this.promises.close=new s.default(this.options.animation.close.bind(this)):(a.addClass(this.barDom,this.options.animation.close),this.promises.close=new s.default((function(t){a.addListener(e.barDom,a.animationEndEvents,(function(){e.options.force?a.remove(e.barDom):c.ghostFix(e),t()}))}))),this.promises.close.then((function(){c.closeFlow(e),c.handleModalClose(e)})),this.closed=!0,this):(c.removeFromQueue(this),this)}}],[{key:"closeAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object.keys(c.Store).forEach((function(t){e?c.Store[t].options.queue===e&&c.Store[t].killable&&c.Store[t].close():c.Store[t].killable&&c.Store[t].close()})),this}},{key:"clearQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global";return c.Queues.hasOwnProperty(e)&&(c.Queues[e].queue=[]),this}},{key:"overrideDefaults",value:function(e){return c.Defaults=a.deepExtend({},c.Defaults,e),this}},{key:"setMaxVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.DefaultMaxVisible,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"global";return c.Queues.hasOwnProperty(t)||(c.Queues[t]={maxVisible:e,queue:[]}),c.Queues[t].maxVisible=e,this}},{key:"button",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new l.NotyButton(e,t,n,r)}},{key:"version",value:function(){return"3.2.0-beta"}},{key:"Push",value:function(e){return new u.Push(e)}},{key:"Queues",get:function(){return c.Queues}},{key:"PageHidden",get:function(){return c.PageHidden}}]),e}();t.default=d,"undefined"!=typeof window&&a.visibilityChangeFlow(),e.exports=t.default},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,l=[],u=!1,f=-1;function d(){u&&c&&(u=!1,c.length?l=c.concat(l):f=-1,l.length&&p())}function p(){if(!u){var e=a(d);u=!0;for(var t=l.length;t;){for(c=l,l=[];++f<t;)c&&c[f].run();f=-1,t=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new h(e,t)),1!==l.length||u||a(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){}])},e.exports=r()},function(e,t){e.exports={event:function(e,t){"undefined"!=typeof ga&&ga("send","event","Game",e,t)}}},function(e,t,n){"use strict";var r=n(10),o={fruit:"../img/fruit-lr2.png",lc:"../img/ai-lc0-cv.png",lc028:"../img/ai-lc0-cv.png",sf12:"../img/sfnnue-sm.png",sf15:"../img/sfnnue-sm.png"};function i(e){var t=e,n="";return 5===e.length&&(n=e.slice(-1),t=e.slice(0,4)),4===t.length?{source:t.slice(0,2),target:t.slice(2),promote:n,original:e}:"err"}function s(e,t){var n=new Chess(e),r=[];t.forEach((function(e){var t=i(e),o=t.source,s=t.target,a=t.promote,c=n.move({from:o,to:s,promotion:a});c||console.error("Kibitzer: Could not process a move!",o,s);var l=n.fen();r.push({fen:l,move:c})}));var o=n.history();return o.length>0?{SAN:o.slice(),FENS:r.slice()}:[]}function a(e,t){var n=r.chess,o=r.flow,i=e.source,s=e.target,a=e.promote,c=e.original,l=n.move({from:i,to:s,promotion:a});if(null===l)throw Error("major error - unparseable move sent from engine");$("#kibitz").find("[data-first-move]").filter((function(){return $(this).data("first-move")!==l.san})).each((function(){$(this).parents("li").remove()})),o.updateMoves(c,l,t),o.executeEngineMove(l)}function c(e,t,n,r){var o,i,s,a=Math.abs(t),c=t+0,l=Number(n.depth);isNaN(l)&&(l=0);var f=!1;(u.prev_score<0&&c>0||u.prev_score>0&&c<0)&&(f=!0);var d=u.active_scale+0;a<=1?(u.active_scale=1,o=100*a):a>1&&a<20?(u.active_scale=10,o=a/20*100):(u.active_scale=100,o=a),i=l,(u.max_score<a||f||u.active_scale!==d)&&(u.max_score=a,u.scaled_score=o),u.max_depth<e&&(u.max_depth=i);var p=Number(n.time),h=0;p&&(h=p<1e3?p/1e3*100:100,p>=u.max_time&&(u.max_time=p+0,u.max_scaled_time=Number(h)));var v=c<0?u.colors.red:u.colors.blue,m=u.colors.green,g=u.colors.black;if(u.ctx){var _=u.ctx;r&&(i=e,o=c,p=null),s=u.max_score,n.mate&&(o=50,u.scaled_score=50,u.max_score=50,s="∞ (mate in "+Number(n.mate)+")"),_.font="11px Lato, Helvetica, Arial, serif",_.clearRect(0,0,175,44),_.fillStyle=m,_.fillText("DEPTH",0,12),_.fillRect(44,4,i,8),!r&&_.fillText(i,44+u.max_depth+8,12),_.fillRect(44+u.max_depth,4,2,8),_.fillStyle=v,_.fillText("SCORE",0,24),_.fillRect(44+u.scaled_score,16,2,8),_.fillRect(44,16,o,8),!r&&_.fillText(s,44+u.scaled_score+8,24),_.fillStyle=g,_.fillText("TIME",0,36),_.fillText(p?Number(p).toLocaleString()+"ms":"",44,36)}else $("#depth-bar").hide()}function l(){for(var e=function(e){setTimeout((function(){return requestAnimationFrame((function(){c(e,e,{time:null,depth:0,score:0},!0)}))}),100)},t=0;t<=100;t++)e(t);setTimeout((function(){return requestAnimationFrame((function(){c(0,0,{time:null,depth:0,score:0},!0)}))}),800)}r.GAME.rand_max=5;var u={updateScore:function(){var e=r.GAME,t=r.engine;e.player_turn||($("#kibitz").text(t.SAN_kibitz.join(", ")),$("#score").html(t.score))},eval_advance:!1,evals:[],eval_msg:[],max_score:0,scaled_score:0,active_scale:1,min_score:0,score_neg:!1,prev_score:0,max_time:0,max_scaled_time:0,ctxInterval:null,rotations:1,colors:{red:"rgba(200,0,0,0.5)",green:"rgb(0,220,100)",blue:"rgba(0, 0, 200, 0.5)",black:"rgba(0,0,0,0.4)",darkBlack:"rgba(0,0,0,.9)"},max_depth:0,setUpCanvas:function(){var e=document.getElementById("depth-bar");e&&e.getContext&&(u.ctx=e.getContext("2d"),l())},updateBook:function(e,t){},resetCanvas:function(e){this.ctx&&(e?this.ctx.clearRect(0,0,175,175):this.ctx.clearRect(0,0,175,50),l())},loadCanvas:function(e){var t=this;this.ctx.clearRect(0,0,175,175);var n=new Image;n.src=o[e],n.onload=function(){t.ctx.drawImage(n,0,0)},this.ctxInterval=setInterval((function(){requestAnimationFrame((function(){!function(e){var t=u.ctx;t.font="11px Lato, Helvetica, Arial, serif",t.fillStyle=u.colors.darkBlack,t.clearRect(44,0,175,44),t.fillText("Remote engine thinking...",54,10),t.fillStyle=u.colors.black;var n=e/8e3*100;t.fillRect(54,16,n,8)}(new Date-t.startLc)}))}),30)},resetEval:function(){this.eval_msg=[],this.evals=[],this.eval_advance=!1,this.max_depth=0,this.max_score=0},evalQueueAdd:function(e,t,n,r){var o=this.evals,i=this.eval_advance;o.push({moveset:e,turn:t,count:n,game_id:r}),"w"===t&&1===n&&(i=!0),i&&this.advanceQueue()},advanceQueue:function(){this.eval_msg=[],this.evals.length>0?(this.requestEval(this.evals[0].moveset),this.eval_advance=!1):this.eval_advance=!0},applyScore:function(e,t){if(e.game_id===r.moves.cid){var n=r.moves.SAN_move_list,o=e.count,i=(e.turn,r.settings.player_color,"w"===r.settings.player_color?1:-1),s=t.score*i;$("#score").text(s);var a=r.sm_chart.data.datasets[0].data,c=r.sm_chart.data.labels;a.push(s),"w"===e.turn?c.push(o):c.push(""),a.length>25&&(a.shift(),c.shift()),r.sm_chart.update(),n[o-1]&&(n[o-1][e.turn+"_score"]=s)}},evalQueueHandleUpdate:function(){var e=this.evals,t=this;r.on("evaluation",(function(n){var r=e.shift();t.applyScore(r,n),t.advanceQueue()}))},processEvalMsg:function(e){var t=e.eval_msg,n=e;r.on("evaluation_msg",(function(e){var o=e.trim();if(t.push(o),t&&t.length&&!(t.length<1))if(/Total Evaluation/i.test(o)){var i=n.parseEvalMsg(t.slice());r.trigger("evaluation",i)}else if(/\|/.test(o)){var s=n.parseEvalMsg(t.slice());s&&s.score&&r.trigger("evaluation_breakdown",s)}}))},parseEvalMsg:function(e){var t={score:null,wEval:{},bEval:{}};return e.forEach((function(e){if(/\|/.test(e)){if(/^term/i.test(e))return;var n=e.split("|").map((function(e){return e.trim()}));if(n.length>0){var r=n[0],o=n[3].split(" ").map((function(e){return e.trim()})),i=o[0],s=o[1];t.wEval[r]="---"===i?null:Number(i),t.bEval[r]="---"===s?null:Number(s)}}else{var a=e.replace(/Total Evaluation:/i,"").replace(/\(white side\)/,"").trim();t.score=Number(a)}})),t},setupEvalHandling:function(){this.engine.onmessage=function(e){try{if(/Stockfish|\s+Eval term|^\s*$|\r\n|^\s+\||^--/.test(e.data))return;r.trigger("evaluation_msg",e.data)}catch(e){console.log(e)}}},getEval:function(e,t,n,r){this.evalQueueAdd(e,t,n,r)},requestEval:function(e){this.engine.postMessage("position startpos moves ".concat(e)),this.engine.postMessage("eval")},setupMsgHandling:function(){this.engine.onmessage=function(e){var t=r.GAME,n=r.moves,o=r.engine_moves,i=$("#kibitz");if(e.data){if(/mate /.test(e.data),/^info depth/.test(e.data)){var a=function(e){for(var t=e.replace("info depth","info_depth").replace("score cp","score_cp").replace("score mate","score_mate").split(" "),n={line:e},r=0;r<t.length;r++){var o=t[r],i=t.indexOf("bmc");switch(o){case"info_depth":n.depth=t[++r];break;case"seldepth":n.seldepth=t[++r];break;case"multipv":++r;break;case"score_cp":n.score=t[++r];break;case"score_mate":n.mate=t[++r],n.score="&infin;";break;case"nodes":case"nps":++r;break;case"time":n.time=t[++r];break;case"pv":n.moves=i>-1?t.slice(++r,i):t.slice(++r)}}return n.moves&&n.moves.length>0&&(n.base_move=n.moves[0]),n}(e.data);if(!a||!a.moves)return;var l=r.chess.fen(),u=$("<li/>"),f=s(l,a.moves.slice(0)),d=f.SAN,p=f.FENS,h=(a.score/100).toFixed(2),v=0,m=0;if(h=isNaN(h)?"--":h,o.SAN_kibitz=d,isNaN(h)||(v=h),p&&p.length&&p.length>0){m=p.length;var g=p.slice(1),_=p[0];u.append(g.map((function(e){return'<span class="k-move" data-fen="'.concat(e.fen,'">').concat(e.move.san,"</span>")})).join("")),u.prepend('<span><span class="score">'.concat(h,'</span><span class="k-move k-first" data-first-move="').concat(_.move.san,'" title="Engine Plays ').concat(_.move.san,'">').concat(_.move.san,"... </span></span>")),i.find("ul").prepend(u)}!function(e,t,n){requestAnimationFrame((function(){c(e,t,n)}))}(m,v,a),$("#kibitz-status").text("")}if(/^bestmove/.test(e.data)){var b={},y=e.data.replace(/bestmove /,"");if(/ponder /.test(e.data)){var w=y.split(" ");b.engine_move=w[0];var x=s(r.chess.fen(),[w[0],w[2]]),k=x.SAN,E=x.FENS;b.ponder_move={SAN:k,FENS:E}}else b.engine_move=y;n.engine_moves.push(b.engine_move),n.engine_move=String(b.engine_move),t.gettingMove.resolve(b)}"debug_UCI"in r.GAME&&r.GAME.debug_UCI&&$("#uci-raw").append("<li>"+e.data+"</li>")}}},updateConfig:function(e){var t="",n=r.settings.strength_profile;if(n){var o={1400:{s:2,c:50},1600:{s:6,c:40},1850:{s:10,c:40},2100:{s:15,c:40},2400:{s:20,c:30}},i=o[n].c,s=o[n].s;switch(e){case"contempt":t="setoption name Contempt value ".concat(i,"\n");break;case"skill":t="setoption name Skill Level value ".concat(s,"\n")}this.postMsg(t)}},start:function(e){e?(this.setupEvalHandling(),this.processEvalMsg(this),this.evalQueueHandleUpdate.bind(this)()):(this.setupMsgHandling(),this.setUpCanvas()),this.startNewGame()},postMsg:function(e){this.engine.postMessage("".concat(e,"\n"))},startNewGame:function(){var e=this.updateConfig.bind(this);["contempt","skill"].forEach((function(t){return e(t)})),this.postMsg("ucinewgame")},getLCEMove:function(e){var t=r.GAME,n=r.moves,o="";e&&"wtime"in e&&"btime"in e&&(o="go wtime ".concat(e.wtime," btime ").concat(e.btime));var i="position "+(t.custom_game?"fen "+t.custom_FEN:"startpos")+" moves "+n.move_list.join(" ");return this.postMsg(i),this.postMsg(o||"go wtime 60000 btime 60000"),$.Deferred()},parseBestMove:function(e){var t={},n=e.replace(/bestmove /,"");if(/ponder /.test(e)){e=n.split(" ");t.engine_move=e[0];var o=s(r.chess.fen(),[e[0],e[2]]),i=o.SAN,a=o.FENS;t.ponder_move={SAN:i,FENS:a}}else t.engine_move=n;return t},getLcMove:function(e){r.GAME;var t=r.moves,n=r.settings.strength_profile,o=t.move_list.join("--"),i=["lc028","fruit","lc028","sf12","sf15"],s=["lc","fruit","lc","sf12","sf15"];n<2200&&1===e&&(e=2);var a=10500,c="";if(0===e&&(a=12e3),"sf12"===s[e]||"sf15"===i[e]||"lc028"===i[e]){var l=1600;n&&(l=n),"sf15"===s[e]&&(l+=100),c="/".concat(l)}var u="https://dbapi.chessui.com/lc0/".concat(i[e],"/");return $("#top-name").removeClass("assist-lc assist-fruit assist-sf12"),$("#top-name").addClass("assist-".concat(s[e])),this.loadCanvas(s[e]),this.startLc=new Date,$("#kibitz").find("ul").html("<li>".concat(["lc0 v.28","fruit","lc0 v.28","stockfish 12","stockfish 15"][e]," evaluating ...</li>")),$("#kibitz-status").text("(cloud engine)"),$.ajax({url:u+o+c,success:function(e){return e},timeout:a})},prepLine:function(e){var t=e.replace("\n\n","\n").split("\n").filter((function(e){return e.indexOf("bestmove")>-1}));t[0];return t[0]&&this.parseBestMove(t[0])||"err"},getRandEngine:function(){return r.GAME.rand_engine},suggestLcMove:function(e,t){var n=this,o=r.GAME;o.gettingLC=this.getLcMove(t),o.gettingLC.then((function(e){var t=e.line;clearInterval(n.ctxInterval);var r=n.prepLine(t),o=i(r.engine_move);$("#kibitz").find("ul").html(""),n.ctx&&n.ctx.clearRect(44,0,175,44);try{a(o,r.ponder_move)}catch(e){throw console.error(e),new Error("oops",e)}})).catch((function(){console.error("Could not get Leela - disallow"),clearInterval(n.ctxInterval),$("#kibitz").find("ul").html(""),r.GAME.allow_leela=!1,n.ctx.restore(),n.suggestMove()}))},suggestMove:function(e){var t=r.GAME;r.engine_moves=r.resetModel("Engine"),t.gettingMove=this.getLCEMove(e),$("#kibitz").find("ul").html(""),$("#top-name").removeClass("assist-lc assist-fruit assist-sf12 assist-sf15"),$.when(t.gettingMove).then((function(e){var t=i(e.engine_move);try{a(t,e.ponder_move)}catch(e){console.error(e)}}))},makeMove:function(e){var t=this.getRandEngine(),n=3;0===t&&(n=0),r.GAME.allow_leela&&r.settings.cloud_engine&&!r.GAME.isMobile&&r.moves.move_number>=n&&r.moves.move_number<50?this.suggestLcMove(e,t):this.suggestMove(e)}};e.exports=function(e,t,n){var o=new Worker("./js/stockfish/v10/stockfish.js");r[e]=Object.create(u,{engine:{value:o}}),r[e].start(n),r[t]=r[e].engine}},function(e,t,n){"use strict";var r=n(10),o=n(71),i={default:"wikipedia",classic:"alpha",book:"uscf"};function s(e){var t=i[e];return"./img/chesspieces/".concat(t,"/{piece}.png")}var a={draggable:!0,dropOffBoard:"snapback",position:"start",moveSpeed:"fast",onDrop:function(e,t){var n=r.GAME,o=r.chess,i=r.flow;if($(".square-target").removeClass("square-target square-attack square-will-check square-is-promo"),!n.player_turn)return"snapback";var s=o.get(e),a="";s&&"p"===s.type&&(/7/.test(e)&&/8/.test(t)||/2/.test(e)&&/1/.test(t))&&(a="q");var c=o.move({from:e,to:t,promotion:a});if(null===c)return"snapback";i.updateMoves(e+t+a,c),i.playerMoved(c)},onDragStart:o((function(e,t,n,o){var i=r.chess,s=r.settings;if(e&&s.show_possible_moves){var a=i.moves({square:e});a.length>0&&a.forEach((function(e){var t=/=/.test(e),n=e.replace(/[pxKQRBN+#!=]/g,"").slice(-2),o="w"===r.GAME.turn,i="square-target".concat(/[x]/.test(e)?" square-attack":/[+#]/.test(e)?" square-will-check":t?" square-is-promo":"");"O-O"===e?n=o?"g1":"g8":"O-O-O"===e&&(n=o?"c1":"c8"),r.settings.show_legal&&$("#board").find(".square-".concat(n)).addClass(i)}))}}),16),onSnapEnd:function(){var e=r.chess;r.board.position(e.fen())},pieceTheme:s(r.settings.pieces)};e.exports={getConfig:function(e,t){return e?t?e:$.extend({},a,e||{}):a},getTheme:s,customGame:function(){var e=r.GAME,t=r.chess,n=r.board;t=new Chess(e.custom_FEN),n.position(t.fen())},init:function(e,t){if(e.length>0){var n=this.getConfig,r=t;e.forEach((function(e){var t=e.name,o=e.override,i=n(e.config,o);t&&t in r&&(r[t]=ChessBoard(t,i))}))}}}},function(e,t){e.exports=function(e,t,n,r,o){var i,s,a,c,l,u,f,d;if(window.Worker&&window.TextEncoder){i=new Worker("./js/openings_worker.min.js"),l=!(!window.localStorage||(window.localStorage.ECO&&localStorage.removeItem("ECO"),!window.localStorage.ECO2))&&(d=window.localStorage.ECO2,(u=u||new TextEncoder("utf-8")).encode(d)),e.$start=$.Deferred(),e.started=!1;var p=setTimeout((function(){e.$start.reject("Timeout"),e.start=!0}),1e4);return l?i.postMessage({msg:"start",ECO:l},[l.buffer]):i.postMessage({msg:"start",ECO:l||""}),i.addEventListener("message",(function(t){var i={},s=[];if("loaded remote data"===t.data.msg&&(!function(e){if(f=f||new TextDecoder("utf-8"),window.localStorage)try{var t=f.decode(e);window.localStorage.ECO2=t}catch(e){console.log(e,"Could not save ECO locally.")}}(t.data.data),e.started=!0,e.$start.resolve(!0),clearTimeout(p)),"loaded local data"===t.data.msg&&(e.started=!0,e.$start.resolve(!0),clearTimeout(p)),"book_got"===t.data.msg&&r(t.data.data),"got_totals"===t.data.msg&&t.data&&t.data.data){var a=t.data.data,c=JSON.stringify(a);localStorage.setItem("chess_totals",c),o.saveRankings(a)}"opening name"===t.data.msg&&("N/A"===t.data.opening.Name?(e.lines=[],n(!1)):(i={lines:t.data.lines.slice(),use_filtered:!1,filtered:s,data:t.data,completed:!0},n(!0,i))),"opening filter"===t.data.msg&&("N/A"===t.data.opening.Name?(e.lines=[],n(!1)):(i={lines:t.data.lines.slice(),use_filtered:!0,filtered:t.data.filtered.slice(),data:t.data,completed:!0},n(!0,i))),"options"===t.data.msg&&(t.data.lines.length>0?(i={lines:t.data.lines.slice(),use_filtered:!1,filtered:s,data:t.data,completed:!0},n(!0,i)):n(!1))})),{w:i,post:function(t){e.started||"start"===t.msg?i.postMessage(t):$.when(e.$start).then((function(){i.postMessage(t)}))},callWorker:function(e){i.postMessage(e)},getOpening:function(){return e.opening=s,e.opening},getCode:function(){return e.code=a,a},getCurrentLine:function(){return e.lines=c,c}}}return!1}}]);